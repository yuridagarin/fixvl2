Include("\\script\\vng\\lib\\vnglib_award.lua");
szNpcName = "<color=green>Häc trß thî rÌn L­u: <color>"
tbThienChiTuongQuan = {
	[0] = {
		[100] = {
			[2241] = {1,"Tèng Thiªn Chi T­íng Qu©n Gi¸p", 0,100,3016},
			[2242] = {1,"Tèng Thiªn Chi T­íng Qu©n Gi¸p", 0,100,3017},
			[2243] = {1,"Tèng Thiªn Chi T­íng Qu©n Gi¸p", 0,100,3018},
			[2244] = {1,"Tèng Thiªn Chi T­íng Qu©n Gi¸p", 0,100,3019},
			[2245] = {1,"Liªu Thiªn Chi T­íng Qu©n Gi¸p", 0,100,3020},
			[2246] = {1,"Liªu Thiªn Chi T­íng Qu©n Gi¸p", 0,100,3021},
			[2247] = {1,"Liªu Thiªn Chi T­íng Qu©n Gi¸p", 0,100,3022},
			[2248] = {1,"Liªu Thiªn Chi T­íng Qu©n Gi¸p", 0,100,3023},
		},
		[101] = {
			[2241] = {1,"Tèng Thiªn Chi T­íng Qu©n Trang", 0,101,3016},
			[2242] = {1,"Tèng Thiªn Chi T­íng Qu©n Trang", 0,101,3017},
			[2243] = {1,"Tèng Thiªn Chi T­íng Qu©n Trang", 0,101,3018},
			[2244] = {1,"Tèng Thiªn Chi T­íng Qu©n Trang", 0,101,3019},
			[2245] = {1,"Liªu Thiªn Chi T­íng Qu©n Trang", 0,101,3020},
			[2246] = {1,"Liªu Thiªn Chi T­íng Qu©n Trang", 0,101,3021},
			[2247] = {1,"Liªu Thiªn Chi T­íng Qu©n Trang", 0,101,3022},
			[2248] = {1,"Liªu Thiªn Chi T­íng Qu©n Trang", 0,101,3023},
		},
		[103] = {
			[2241] = {1,"Tèng Thiªn Chi T­íng Qu©n Kh«i", 0,103,3016},
			[2242] = {1,"Tèng Thiªn Chi T­íng Qu©n Kh«i", 0,103,3017},
			[2243] = {1,"Tèng Thiªn Chi T­íng Qu©n Kh«i", 0,103,3018},
			[2244] = {1,"Tèng Thiªn Chi T­íng Qu©n Kh«i", 0,103,3019},
			[2245] = {1,"Liªu Thiªn Chi T­íng Qu©n Kh«i", 0,103,3020},
			[2246] = {1,"Liªu Thiªn Chi T­íng Qu©n Kh«i", 0,103,3021},
			[2247] = {1,"Liªu Thiªn Chi T­íng Qu©n Kh«i", 0,103,3022},
			[2248] = {1,"Liªu Thiªn Chi T­íng Qu©n Kh«i", 0,103,3023},
		},
		[102] = {
			[2281] = {2,"Tèng Thiªn Chi T­íng Qu©n LÖnh Bµi", 0,102,3032},
			[2285] = {2,"Tèng Thiªn Chi T­íng Qu©n LÖnh Kú", 0,102,3036},
			[2521] = {2,"Tèng Thiªn Chi T­íng Qu©n LÖnh Phï", 0,102,3040},
			[2282] = {2,"Tèng Thiªn Chi T­íng Qu©n LÖnh Bµi", 0,102,3033},
			[2286] = {2,"Tèng Thiªn Chi T­íng Qu©n LÖnh Kú", 0,102,3037},
			[2522] = {2,"Tèng Thiªn Chi T­íng Qu©n LÖnh Phï", 0,102,3041},
			[2283] = {2,"Tèng Thiªn Chi T­íng Qu©n LÖnh Bµi", 0,102,3034},
			[2287] = {2,"Tèng Thiªn Chi T­íng Qu©n LÖnh Kú", 0,102,3038},
			[2523] = {2,"Tèng Thiªn Chi T­íng Qu©n LÖnh Phï", 0,102,3042},
			[2284] = {2,"Tèng Thiªn Chi T­íng Qu©n LÖnh Bµi", 0,102,3035},
			[2288] = {2,"Tèng Thiªn Chi T­íng Qu©n LÖnh Kú", 0,102,3039},
			[2524] = {2,"Tèng Thiªn Chi T­íng Qu©n LÖnh Phï", 0,102,3043},
			------------ Tong
			[2291] = {2,"Liªu Thiªn Chi T­íng Qu©n LÖnh Bµi", 0,102,3044},
			[2295] = {2,"Liªu Thiªn Chi T­íng Qu©n LÖnh Kú", 0,102,3048},
			[2531] = {2,"Liªu Thiªn Chi T­íng Qu©n LÖnh Phï", 0,102,3052},
			[2292] = {2,"Liªu Thiªn Chi T­íng Qu©n LÖnh Bµi", 0,102,3045},
			[2296] = {2,"Liªu Thiªn Chi T­íng Qu©n LÖnh Kú", 0,102,3049},
			[2532] = {2,"Liªu Thiªn Chi T­íng Qu©n LÖnh Phï", 0,102,3053},
			[2293] = {2,"Liªu Thiªn Chi T­íng Qu©n LÖnh Bµi", 0,102,3046},
			[2297] = {2,"Liªu Thiªn Chi T­íng Qu©n LÖnh Kú", 0,102,3050},
			[2533] = {2,"Liªu Thiªn Chi T­íng Qu©n LÖnh Phï", 0,102,3054},
			[2294] = {2,"Liªu Thiªn Chi T­íng Qu©n LÖnh Bµi", 0,102,3047},
			[2298] = {2,"Liªu Thiªn Chi T­íng Qu©n LÖnh Kú", 0,102,3051},
			[2534] = {2,"Liªu Thiªn Chi T­íng Qu©n LÖnh Phï", 0,102,3055},
		},
	},
}

function OnPutinCheck(param, idx, genre, detail, particular)
	--local tbCheckList = GetPutinItem();
	if tbThienChiTuongQuan[genre] == nil then
		Talk(1,"",szNpcName .. "Ta chØ nhËn ®æi trang bÞ Tèng/Liªu T­íng Qu©n.")
		return 0
	end
	if tbThienChiTuongQuan[genre][detail] == nil then
		Talk(1,"",szNpcName .. "Ta chØ nhËn ®æi trang bÞ Tèng/Liªu T­íng Qu©n.")
		return 0
	end
	if tbThienChiTuongQuan[genre][detail][particular] == nil then
		Talk(1,"",szNpcName .. "Ta chØ nhËn ®æi trang bÞ Tèng/Liªu T­íng Qu©n.")
		return 0
	end
	
	if detail ~= 102 then
		if GetEquipAttr(idx,2) < 7 then
			Talk(1,"",szNpcName .. "Trang bÞ ph¶i ®­îc c­êng hãa 7 trë lªn.")
			return 0
		end
	end
	return 1
end


function OnPutinComplete(param)
	if gf_JudgeRoomWeight(1,100) == 0 then
		Talk(1,"",szNpcName.."Hµnh trang hoÆc søc lùc kh«ng ®ñ, ng­¬i h·y s¾p xÕp l¹i nhÐ!");
		return 0
	end
	local tbUpgradeList = GetPutinItem();
	local nG, nD, nP = tbUpgradeList[1][2], tbUpgradeList[1][3], tbUpgradeList[1][4]
	if tbThienChiTuongQuan[nG][nD][nP] == nil then
		return 0
	end
	
	-------------------- Check material ----------------------------
	local nThienThachLinhThach, nTieuDinhHon, nDaiDinhHon, nGold = 1,1,1, 5000
	if  tbThienChiTuongQuan[nG][nD][nP][1] ~= 1 then
		nThienThachLinhThach, nTieuDinhHon, nDaiDinhHon, nGold = 2,1,1, 5000
	end
	if GetItemCount(2,1,1068) < nThienThachLinhThach then
		Talk(1,"",szNpcName.."Ta cÇn "..nThienThachLinhThach.." Thiªn Th¹ch Linh Th¹ch, rÊt tiÕc c¸c h¹ kh«ng cã ®ñ.")
		return 0
	end
	if GetItemCount(2,1,1067) < nTieuDinhHon then
		Talk(1,"",szNpcName.."Ta cÇn "..nTieuDinhHon.." §Þnh Hån Thiªn Th¹ch ThÇn Th¹ch, rÊt tiÕc c¸c h¹ kh«ng cã ®ñ.")
		return 0
	end
	if GetItemCount(2,1,1113) < nDaiDinhHon then
		Talk(1,"",szNpcName.."Ta cÇn "..nDaiDinhHon.." §¹i §Þnh Hån, rÊt tiÕc c¸c h¹ kh«ng cã ®ñ.")
		return 0
	end
	if GetCash() < nGold*10000 then
		Talk(1,"",szNpcName.."Ta cÇn "..nGold.." vµng, rÊt tiÕc c¸c h¹ kh«ng cã ®ñ.")
		return 0
	end
	
	local nLevel = 0
	LIB_Award.szLogTitle = "NANG CAP TRANG BI TUONG QUAN"
	LIB_Award.szLogAction = "thµnh c«ng"
	local tbNewItem = {item={{
			gdp={tbThienChiTuongQuan[nG][nD][nP][3],tbThienChiTuongQuan[nG][nD][nP][4],tbThienChiTuongQuan[nG][nD][nP][5],1,1, -1, -1, -1, -1, -1, -1, -1, nLevel},
			name = tbThienChiTuongQuan[nG][nD][nP][2]}}
		}
	if DelItem(2,1,1068,nThienThachLinhThach) == 1 and DelItem(2,1,1067,nTieuDinhHon) == 1 and DelItem(2,1,1113,nDaiDinhHon) == 1 and Pay(nGold*10000) then
		DelItemByIndex(tbUpgradeList[1][1],-1)
		LIB_Award:Award(tbNewItem)
		Talk(1,"",szNpcName.."N©ng cÊp thµnh c«ng, h·y nhËn lÊy " .. tbThienChiTuongQuan[nG][nD][nP][2] .. " cña ng­¬i.")
	else
		Talk(1,"",szNpcName.."C¸c h¹ kh«ng ®ñ vËt phÈm yªu cÇu, kh«ng thÓ tiÕn hµnh n©ng cÊp.")
	end
	return 1
end
