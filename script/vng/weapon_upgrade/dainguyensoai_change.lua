Include("\\script\\vng\\lib\\vnglib_award.lua");
szNpcName = "<color=green>Häc trß thî rÌn L­u: <color>"
tbDaiNguyenSoai = {
	[0] = {
		[100] = {
			[3024] = {1,"Liªu §¹i Nguyªn So¸i ChiÕn Gi¸p", 0,100,3028},
			[3025] = {1,"Liªu §¹i Nguyªn So¸i ChiÕn Gi¸p", 0,100,3029},
			[3026] = {1,"Liªu §¹i Nguyªn So¸i ChiÕn Gi¸p", 0,100,3030},
			[3027] = {1,"Liªu §¹i Nguyªn So¸i ChiÕn Gi¸p", 0,100,3031},
			[3028] = {1,"Tèng §¹i Nguyªn So¸i ChiÕn Gi¸p", 0,100,3024},
			[3029] = {1,"Tèng §¹i Nguyªn So¸i ChiÕn Gi¸p", 0,100,3025},
			[3030] = {1,"Tèng §¹i Nguyªn So¸i ChiÕn Gi¸p", 0,100,3026},
			[3031] = {1,"Tèng §¹i Nguyªn So¸i ChiÕn Gi¸p", 0,100,3027},
		},
		[101] = {
			[3024] = {1,"Liªu §¹i Nguyªn So¸i ChiÕn Trang", 0,101,3028},
			[3025] = {1,"Liªu §¹i Nguyªn So¸i ChiÕn Trang", 0,101,3029},
			[3026] = {1,"Liªu §¹i Nguyªn So¸i ChiÕn Trang", 0,101,3030},
			[3027] = {1,"Liªu §¹i Nguyªn So¸i ChiÕn Trang", 0,101,3031},
			[3028] = {1,"Tèng §¹i Nguyªn So¸i ChiÕn Trang", 0,101,3024},
			[3029] = {1,"Tèng §¹i Nguyªn So¸i ChiÕn Trang", 0,101,3025},
			[3030] = {1,"Tèng §¹i Nguyªn So¸i ChiÕn Trang", 0,101,3026},
			[3031] = {1,"Tèng §¹i Nguyªn So¸i ChiÕn Trang", 0,101,3027},
		},
		[103] = {
			[3024] = {1,"Liªu §¹i Nguyªn So¸i ChiÕn Kh«i", 0,103,3028},
			[3025] = {1,"Liªu §¹i Nguyªn So¸i ChiÕn Kh«i", 0,103,3029},
			[3026] = {1,"Liªu §¹i Nguyªn So¸i ChiÕn Kh«i", 0,103,3030},
			[3027] = {1,"Liªu §¹i Nguyªn So¸i ChiÕn Kh«i", 0,103,3031},
			[3028] = {1,"Tèng §¹i Nguyªn So¸i ChiÕn Kh«i", 0,103,3024},
			[3029] = {1,"Tèng §¹i Nguyªn So¸i ChiÕn Kh«i", 0,103,3025},
			[3030] = {1,"Tèng §¹i Nguyªn So¸i ChiÕn Kh«i", 0,103,3026},
			[3031] = {1,"Tèng §¹i Nguyªn So¸i ChiÕn Kh«i", 0,103,3027},
		},
		[102] = {
			[3056] = {2,"Liªu §¹i Nguyªn So¸i Hæ Phï", 0,102,3072},
			[3060] = {2,"Liªu §¹i Nguyªn So¸i LÖnh Kú", 0,102,3076},
			[3064] = {2,"Liªu §¹i Nguyªn So¸i HiÖu Phï", 0,102,3080},
			[3068] = {2,"Liªu §¹i Nguyªn So¸i HiÖu Kú", 0,102,3084},
			[3057] = {2,"Liªu §¹i Nguyªn So¸i Hæ Phï", 0,102,3073},
			[3061] = {2,"Liªu §¹i Nguyªn So¸i LÖnh Kú", 0,102,3077},
			[3065] = {2,"Liªu §¹i Nguyªn So¸i HiÖu Phï", 0,102,3081},
			[3069] = {2,"Liªu §¹i Nguyªn So¸i HiÖu Kú", 0,102,3085},
			[3058] = {2,"Liªu §¹i Nguyªn So¸i Hæ Phï", 0,102,3074},
			[3062] = {2,"Liªu §¹i Nguyªn So¸i LÖnh Kú", 0,102,3078},
			[3066] = {2,"Liªu §¹i Nguyªn So¸i HiÖu Phï", 0,102,3082},
			[3070] = {2,"Liªu §¹i Nguyªn So¸i HiÖu Kú", 0,102,3086},
			[3059] = {2,"Liªu §¹i Nguyªn So¸i Hæ Phï", 0,102,3075},
			[3063] = {2,"Liªu §¹i Nguyªn So¸i LÖnh Kú", 0,102,3079},
			[3067] = {2,"Liªu §¹i Nguyªn So¸i HiÖu Phï", 0,102,3083},
			[3071] = {2,"Liªu §¹i Nguyªn So¸i HiÖu Kú", 0,102,3087},
			------------ Tong
			[3072] = {2,"Tèng §¹i Nguyªn So¸i Hæ Phï", 0,102,3056},
			[3076] = {2,"Tèng §¹i Nguyªn So¸i LÖnh Kú", 0,102,3060},
			[3080] = {2,"Tèng §¹i Nguyªn So¸i HiÖu Phï", 0,102,3064},
			[3084] = {2,"Tèng §¹i Nguyªn So¸i HiÖu Kú", 0,102,3068},
			[3073] = {2,"Tèng §¹i Nguyªn So¸i Hæ Phï", 0,102,3057},
			[3077] = {2,"Tèng §¹i Nguyªn So¸i LÖnh Kú", 0,102,3061},
			[3081] = {2,"Tèng §¹i Nguyªn So¸i HiÖu Phï", 0,102,3065},
			[3085] = {2,"Tèng §¹i Nguyªn So¸i HiÖu Kú", 0,102,3069},
			[3074] = {2,"Tèng §¹i Nguyªn So¸i Hæ Phï", 0,102,3058},
			[3078] = {2,"Tèng §¹i Nguyªn So¸i LÖnh Kú", 0,102,3062},
			[3082] = {2,"Tèng §¹i Nguyªn So¸i HiÖu Phï", 0,102,3066},
			[3086] = {2,"Tèng §¹i Nguyªn So¸i HiÖu Kú", 0,102,3070},
			[3075] = {2,"Tèng §¹i Nguyªn So¸i Hæ Phï", 0,102,3059},
			[3079] = {2,"Tèng §¹i Nguyªn So¸i LÖnh Kú", 0,102,3063},
			[3083] = {2,"Tèng §¹i Nguyªn So¸i HiÖu Phï", 0,102,3067},
			[3087] = {2,"Tèng §¹i Nguyªn So¸i HiÖu Kú", 0,102,3071},
		},
	},
}

function OnPutinCheck(param, idx, genre, detail, particular)
	--local tbCheckList = GetPutinItem();
	if tbDaiNguyenSoai[genre] == nil then
		Talk(1,"",szNpcName .. "Ta chØ nhËn ®æi trang bÞ Tèng/Liªu §¹i Nguyªn So¸i.")
		return 0
	end
	if tbDaiNguyenSoai[genre][detail] == nil then
		Talk(1,"",szNpcName .. "Ta chØ nhËn ®æi trang bÞ Tèng/Liªu §¹i Nguyªn So¸i.")
		return 0
	end
	if tbDaiNguyenSoai[genre][detail][particular] == nil then
		Talk(1,"",szNpcName .. "Ta chØ nhËn ®æi trang bÞ Tèng/Liªu §¹i Nguyªn So¸i.")
		return 0
	end
	
	if detail ~= 102 then
		if GetEquipAttr(idx,2) < 13 then
			Talk(1,"",szNpcName .. "Trang bÞ ph¶i ®­îc c­êng hãa 13 trë lªn.")
			return 0
		end
	end
	return 1
end


function OnPutinComplete(param)
	if gf_JudgeRoomWeight(1,100) == 0 then
		Talk(1,"",szNpcName.."Hµnh trang hoÆc søc lùc kh«ng ®ñ, ng­¬i h·y s¾p xÕp l¹i nhÐ!");
		return 0
	end
	local tbUpgradeList = GetPutinItem();
	local nG, nD, nP = tbUpgradeList[1][2], tbUpgradeList[1][3], tbUpgradeList[1][4]
	if tbDaiNguyenSoai[nG][nD][nP] == nil then
		return 0
	end
	
	-------------------- Check material ----------------------------
	local tbMaterial = {
		[1] = {item={{gdp={2,1,1009,20}, name="Thiªn Th¹ch Tinh Th¹ch"}}, nGold = 40000000},
		[2] = {item={{gdp={2,1,1009,35}, name="Thiªn Th¹ch Tinh Th¹ch"}}, nGold = 50000000}
	}
	local nIndex = tbDaiNguyenSoai[nG][nD][nP][1]
	local nCheck = LIB_Award:CheckMaterial(tbMaterial[nIndex])
	if nCheck == 0 then
		return 0
	end

	LIB_Award.szLogTitle = "CHUYEN DOI TRANG BI DAI NGUYEN SOAI"
	LIB_Award.szLogAction = "thµnh c«ng"
	local nLevel = 13
	if nIndex ==2 then
		nLevel = 0
	end
	local tbNewItem = {item={{
			gdp={tbDaiNguyenSoai[nG][nD][nP][3],tbDaiNguyenSoai[nG][nD][nP][4],tbDaiNguyenSoai[nG][nD][nP][5],1,1, -1, -1, -1, -1, -1, -1, -1, nLevel},
			name = tbDaiNguyenSoai[nG][nD][nP][2]}}
		}
	LIB_Award:PayMaterial(tbMaterial[nIndex])
	DelItemByIndex(tbUpgradeList[1][1],-1)
	LIB_Award:Award(tbNewItem)
	Talk(1,"",szNpcName.."ChuyÓn ®æi  thµnh c«ng, h·y nhËn lÊy " .. tbDaiNguyenSoai[nG][nD][nP][2] .. " cña ng­¬i.")
	return 1
end
