Include("\\script\\vng\\lib\\vnglib_award.lua");
szNpcName = "<color=green>Häc trß thî rÌn L­u: <color>"


tbThuongUngTuongQuan = {
	[0] = {
		[100] = {
			[3020] = {1,"Liªu Th­¬ng ¦ng T­íng Qu©n Gi¸p", 0,100,30045},
			[3021] = {1,"Liªu Th­¬ng ¦ng T­íng Qu©n Gi¸p", 0,100,30046},
			[3022] = {1,"Liªu Th­¬ng ¦ng T­íng Qu©n Gi¸p", 0,100,30047},
			[3023] = {1,"Liªu Th­¬ng ¦ng T­íng Qu©n Gi¸p", 0,100,30048},
			[3016] = {1,"Tèng Th­¬ng ¦ng T­íng Qu©n Gi¸p", 0,100,30033},
			[3017] = {1,"Tèng Th­¬ng ¦ng T­íng Qu©n Gi¸p", 0,100,30034},
			[3018] = {1,"Tèng Th­¬ng ¦ng T­íng Qu©n Gi¸p", 0,100,30035},
			[3019] = {1,"Tèng Th­¬ng ¦ng T­íng Qu©n Gi¸p", 0,100,30036},
		},
		[101] = {
			[3020] = {1,"Liªu Th­¬ng ¦ng T­íng Qu©n Trang", 0,101,30045},
			[3021] = {1,"Liªu Th­¬ng ¦ng T­íng Qu©n Trang", 0,101,30046},
			[3022] = {1,"Liªu Th­¬ng ¦ng T­íng Qu©n Trang", 0,101,30047},
			[3023] = {1,"Liªu Th­¬ng ¦ng T­íng Qu©n Trang", 0,101,30048},
			[3016] = {1,"Tèng Th­¬ng ¦ng T­íng Qu©n Trang", 0,101,30033},
			[3017] = {1,"Tèng Th­¬ng ¦ng T­íng Qu©n Trang", 0,101,30034},
			[3018] = {1,"Tèng Th­¬ng ¦ng T­íng Qu©n Trang", 0,101,30035},
			[3019] = {1,"Tèng Th­¬ng ¦ng T­íng Qu©n Trang", 0,101,30036},
		},
		[103] = {
			[3020] = {1,"Liªu Th­¬ng ¦ng T­íng Qu©n Kh«i", 0,103,30045},
			[3021] = {1,"Liªu Th­¬ng ¦ng T­íng Qu©n Kh«i", 0,103,30046},
			[3022] = {1,"Liªu Th­¬ng ¦ng T­íng Qu©n Kh«i", 0,103,30047},
			[3023] = {1,"Liªu Th­¬ng ¦ng T­íng Qu©n Kh«i", 0,103,30048},
			[3016] = {1,"Tèng Th­¬ng ¦ng T­íng Qu©n Kh«i", 0,103,30033},
			[3017] = {1,"Tèng Th­¬ng ¦ng T­íng Qu©n Kh«i", 0,103,30034},
			[3018] = {1,"Tèng Th­¬ng ¦ng T­íng Qu©n Kh«i", 0,103,30035},
			[3019] = {1,"Tèng Th­¬ng ¦ng T­íng Qu©n Kh«i", 0,103,30036},
		},
		[102] = {
			[3044] = {2,"Liªu Th­¬ng ¦ng T­íng Qu©n LÖnh Bµi", 0,102,30088},
			[3048] = {2,"Liªu Th­¬ng ¦ng T­íng Qu©n LÖnh Kú", 0,102,30092},
			[3052] = {2,"Liªu Th­¬ng ¦ng T­íng Qu©n LÖnh Phï", 0,102,30096},
			[3045] = {2,"Liªu Th­¬ng ¦ng T­íng Qu©n LÖnh Bµi", 0,102,30089},
			[3049] = {2,"Liªu Th­¬ng ¦ng T­íng Qu©n LÖnh Kú", 0,102,30093},
			[3053] = {2,"Liªu Th­¬ng ¦ng T­íng Qu©n LÖnh Phï", 0,102,30097},
			[3046] = {2,"Liªu Th­¬ng ¦ng T­íng Qu©n LÖnh Bµi", 0,102,30090},
			[3050] = {2,"Liªu Th­¬ng ¦ng T­íng Qu©n LÖnh Kú", 0,102,30094},
			[3054] = {2,"Liªu Th­¬ng ¦ng T­íng Qu©n LÖnh Phï", 0,102,30098},
			[3047] = {2,"Liªu Th­¬ng ¦ng T­íng Qu©n LÖnh Bµi", 0,102,30091},
			[3051] = {2,"Liªu Th­¬ng ¦ng T­íng Qu©n LÖnh Kú", 0,102,30095},
			[3055] = {2,"Liªu Th­¬ng ¦ng T­íng Qu©n LÖnh Phï", 0,102,30099},
			------------ Tong
			[3032] = {2,"Tèng Th­¬ng ¦ng T­íng Qu©n LÖnh Bµi", 0,102,30052},
			[3036] = {2,"Tèng Th­¬ng ¦ng T­íng Qu©n LÖnh Kú", 0,102,30056},
			[3040] = {2,"Tèng Th­¬ng ¦ng T­íng Qu©n LÖnh Phï", 0,102,30060},
			[3033] = {2,"Tèng Th­¬ng ¦ng T­íng Qu©n LÖnh Bµi", 0,102,30053},
			[3037] = {2,"Tèng Th­¬ng ¦ng T­íng Qu©n LÖnh Kú", 0,102,30057},
			[3041] = {2,"Tèng Th­¬ng ¦ng T­íng Qu©n LÖnh Phï", 0,102,30061},
			[3034] = {2,"Tèng Th­¬ng ¦ng T­íng Qu©n LÖnh Bµi", 0,102,30054},
			[3038] = {2,"Tèng Th­¬ng ¦ng T­íng Qu©n LÖnh Kú", 0,102,30058},
			[3042] = {2,"Tèng Th­¬ng ¦ng T­íng Qu©n LÖnh Phï", 0,102,30062},
			[3035] = {2,"Tèng Th­¬ng ¦ng T­íng Qu©n LÖnh Bµi", 0,102,30055},
			[3039] = {2,"Tèng Th­¬ng ¦ng T­íng Qu©n LÖnh Kú", 0,102,30059},
			[3043] = {2,"Tèng Th­¬ng ¦ng T­íng Qu©n LÖnh Phï", 0,102,30063},
		},
	},
}


function OnPutinCheck(param, idx, genre, detail, particular)
	--local tbCheckList = GetPutinItem();
	if tbThuongUngTuongQuan[genre] == nil then
		Talk(1,"",szNpcName .. "Ta chØ nhËn ®æi trang bÞ Thiªn Chi Tèng/Liªu T­íng Qu©n.")
		return 0
	end
	if tbThuongUngTuongQuan[genre][detail] == nil then
		Talk(1,"",szNpcName .. "Ta chØ nhËn ®æi trang bÞ Thiªn Chi Tèng/Liªu T­íng Qu©n.")
		return 0
	end
	if tbThuongUngTuongQuan[genre][detail][particular] == nil then
		Talk(1,"",szNpcName .. "Ta chØ nhËn ®æi trang bÞ Thiªn Chi Tèng/Liªu T­íng Qu©n.")
		return 0
	end
	
	if detail ~= 102 then
		if GetEquipAttr(idx,2) < 7 then
			Talk(1,"",szNpcName .. "Trang bÞ ph¶i ®­îc c­êng hãa 7 trë lªn.")
			return 0
		end
	end
	return 1
end


function OnPutinComplete(param)
	if gf_JudgeRoomWeight(1,100) == 0 then
		Talk(1,"",szNpcName.."Hµnh trang hoÆc søc lùc kh«ng ®ñ, ng­¬i h·y s¾p xÕp l¹i nhÐ!");
		return 0
	end
	local tbUpgradeList = GetPutinItem();
	local nG, nD, nP = tbUpgradeList[1][2], tbUpgradeList[1][3], tbUpgradeList[1][4]
	if tbThuongUngTuongQuan[nG][nD][nP] == nil then
		return 0
	end
	
	-------------------- Check material ----------------------------
	local tbMaterial = {
		[1] = {item={{gdp={2,95,204,11}, name="Thiªn Cang LÖnh"}, {gdp={2,1,30370,11}, name="Thiªn M«n Kim LÖnh"}, {gdp={2,1,504,3}, name="N÷ Oa Tinh Th¹ch"}, {gdp={2,1,1009,50}, name="Thiªn Th¹ch Tinh Th¹ch"}}, nGold = 30000000},
		[2] = {item={{gdp={2,95,204,11}, name="Thiªn Cang LÖnh"}, {gdp={2,1,30370,11}, name="Thiªn M«n Kim LÖnh"}, {gdp={2,1,504,3}, name="N÷ Oa Tinh Th¹ch"}, {gdp={2,1,1009,70}, name="Thiªn Th¹ch Tinh Th¹ch"}}, nGold = 40000000},
	}
	local nIndex = tbThuongUngTuongQuan[nG][nD][nP][1]
	local nCheck = LIB_Award:CheckMaterial(tbMaterial[nIndex])
	if nCheck == 0 then
		return 0
	end
	
	local nLevel = 0
	LIB_Award.szLogTitle = "NANG CAP TC TUONG QUAN - TU TUONG QUAN"
	LIB_Award.szLogAction = "thµnh c«ng"
	local tbNewItem = {item={{
			gdp={tbThuongUngTuongQuan[nG][nD][nP][3],tbThuongUngTuongQuan[nG][nD][nP][4],tbThuongUngTuongQuan[nG][nD][nP][5],1,1, -1, -1, -1, -1, -1, -1, -1, nLevel},
			name = tbThuongUngTuongQuan[nG][nD][nP][2]}}
		}
	LIB_Award:PayMaterial(tbMaterial[nIndex])
	DelItemByIndex(tbUpgradeList[1][1],-1)
	LIB_Award:Award(tbNewItem)
	Talk(1,"",szNpcName.."N©ng cÊp thµnh c«ng, h·y nhËn lÊy " .. tbThuongUngTuongQuan[nG][nD][nP][2] .. " cña ng­¬i.")
	return 1
end
