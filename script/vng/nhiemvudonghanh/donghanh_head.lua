szLogTitle = "NHIEM VU DONG HANH"
szNPCName = "<color=green>Long Quang Ch©n Nh©n:<color> "

tbDongHanhRate = {
	[1] = {[1] = 1, nRate = 5.00},	-- 3 lÇn Tµi Nguyªn ChiÕn
	[2] = {[1] = 2, nRate = 5.00},	-- 4 lÇn Tµi Nguyªn ChiÕn
	[3] = {[1] = 3, nRate = 5.00},	-- 3 lÇn ThÞt N­íng
	[4] = {[1] = 4, nRate = 5.00},	-- 5 lÇn ThÞt N­íng
	[5] = {[1] = 5, nRate = 5.00},	-- 1 lÇn N«ng Trang
	[6] = {[1] = 6, nRate = 5.00},	-- 1 lÇn L­¬ng Th¶o
	[7] = {[1] = 7, nRate = 5.00},	-- 1 lÇn Thµnh Tr×
	[8] = {[1] = 8, nRate = 5.00},	-- 1 lÇn Nh¹n M«n Quan
	[9] = {[1] = 9, nRate = 5.00},	-- 2 lÇn Thiªn M«n TrËn
	[10] = {[1] = 10, nRate = 5.00},	-- 3 lÇn Thiªn M«n TrËn
	[11] = {[1] = 11, nRate = 5.00},	-- 1 lÇn Th¸i H­
	[12] = {[1] = 12, nRate = 0.00},	-- 10 lÇn Th­¬ng Héi
	[13] = {[1] = 13, nRate = 0.00},	-- 20 lÇn Th­¬ng Héi
	[14] = {[1] = 14, nRate = 0.00},	-- 30 lÇn Th­¬ng Héi
	[15] = {[1] = 15, nRate = 0.00},	-- 40 lÇn Th­¬ng Héi
	[16] = {[1] = 16, nRate = 5.00},	-- 1 lÇn Thñy Lîi - TrÞ Quèc B×nh Thiªn H¹
	[17] = {[1] = 17, nRate = 5.00},	-- 6 lÇn thu ho¹ch h¹t gièng
	[18] = {[1] = 18, nRate = 5.00},	-- 6 lÇn thu ho¹ch B¸t Nh· Nhá
	[19] = {[1] = 19, nRate = 5.00},	-- 1 lÇn thu ho¹ch B¸t Nh· Lín
	[20] = {[1] = 20, nRate = 5.00},	-- 1 lÇn thu ho¹ch c©y Tø Linh
	[21] = {[1] = 21, nRate = 5.00},	-- 20 ph¸o hoa
	[22] = {[1] = 22, nRate = 5.00},	-- tÆng 2 mËt tÞch
	[23] = {[1] = 23, nRate = 5.00},	-- tÆng 3 mËt tÞch
	[24] = {[1] = 24, nRate = 5.00},	-- tÆng 20 tr¸i c©y
	[25] = {[1] = 25, nRate = 0.00},	-- tÆng 8v + 8xu
	[26] = {[1] = 26, nRate = 5.00},	-- 2 nv L­¬ng S¬n B¹c
}

tbDongHanhName = {
	[1] = {"Hoµn thµnh 03 lÇn nhËn th­ëng nhiÖm vô Tµi Nguyªn ChiÕn", 3},
	[2] = {"Hoµn thµnh 04 nhËn th­ëng nhiÖm vô Tµi Nguyªn ChiÕn", 4},
	[3] = {"Hoµn thµnh 03 lÇn nhËn th­ëng nhiÖm vô ThÞt N­íng", 3},
	[4] = {"Hoµn thµnh 05 lÇn nhËn th­ëng nhiÖm vô ThÞt N­íng", 5},
	[5] = {"Hoµn thµnh 01 lÇn nhËn th­ëng chiÕn tr­êng N«ng Trang", 1},
	[6] = {"Hoµn thµnh 01 lÇn nhËn th­ëng chiÕn tr­êng L­¬ng Th¶o", 1},
	[7] = {"Hoµn thµnh 01 lÇn nhËn th­ëng chiÕn tr­êng Thµnh Tr×", 1},
	[8] = {"Hoµn thµnh 01 lÇn nhËn th­ëng chiÕn tr­êng Nh¹n M«n Quan", 1},
	[9] = {"Hoµn thµnh 02 lÇn nhËn th­ëng chiÕn tr­êng Thiªn M«n TrËn", 2},
	[10] = {"Hoµn thµnh 03 lÇn nhËn th­ëng chiÕn tr­êng Thiªn M«n TrËn", 3},
	[11] = {"Hoµn thµnh 01 lÇn v­ît Th¸i H­ HuyÔn C¶nh", 1},
	[12] = {"Hoµn thµnh 10 lÇn nhiÖm vô Th­¬ng Héi", 10},
	[13] = {"Hoµn thµnh 20 lÇn nhiÖm vô Th­¬ng Héi", 20},
	[14] = {"Hoµn thµnh 30 lÇn nhiÖm vô Th­¬ng Héi", 30},
	[15] = {"Hoµn thµnh 40 lÇn nhiÖm vô Th­¬ng Héi", 40},
	[16] = {"Nép thµnh c«ng 01 lÇn Thñy Lîi - TrÞ Quèc B×nh Thiªn H¹", 1},
	[17] = {"Trång thµnh c«ng 06 H¹t Gièng", 6},
	[18] = {"Trång thµnh c«ng 06 c©y B¸t Nh· Nhá", 6},
	[19] = {"Trång thµnh c«ng 01 c©y B¸t Nh· Lín", 1},
	[20] = {"Trång thµnh c«ng 01 c©y Tø Linh", 1},
	[21] = {"Sö dông thµnh c«ng 20 Ph¸o Hoa", 20},
	[22] = {"TÆng ta 02 cuèn mËt tÞch bÊt kú", 1},
	[23] = {"TÆng ta 03 cuèn mËt tÞch bÊt kú", 1},
	[24] = {"TÆng ta 20 tr¸i c©y bÊt kú", 1},
	[25] = {"TÆng ta 08 vµng vµ 08 xu vËt phÈm", 1},
	[26] = {"Hoµn thµnh 02 nhiÖm vô L­¬ng S¬n B¹c", 2},
}

tbMissionQty = {
	[1] = {nGold = 0, nXu = 0},
	[2] = {nGold = 2, nXu = 2},
	[3] = {nGold = 6, nXu = 6},
	[4] = {nGold = 10, nXu = 10},
}
	
function DongHanh_GetCount()
	local nTaskValue = GetTask(TSK_DONGHANH)
	local nMissionCount = GetByte(nTaskValue,2)*256 + GetByte(nTaskValue,1)
	return nMissionCount
end

function DongHanh_AddCount(nValue)
	nValue = nValue or 1
	local nTaskValue = GetTask(TSK_DONGHANH)
	local nMissionCount = GetByte(nTaskValue,2)*256 + GetByte(nTaskValue,1) + nValue
	local nByte2 = floor(nMissionCount/256)
	local nByte1 = mod(nMissionCount,256)
	gf_SetTaskByte(TSK_DONGHANH, 2, nByte2)
	gf_SetTaskByte(TSK_DONGHANH, 1, nByte1)
	gf_WriteLogEx(szLogTitle,"hoµn thµnh",1,"Hoµn thµnh nhiÖm vô thø "..nMissionCount)
end

--===========================
function DongHanh_GetMission()	-- LÊy nhiÖm vô ®ang thùc hiÖn
	return gf_GetTaskByte(TSK_DONGHANH, 3)
end

function DongHanh_SetMission()	-- Set nhiÖm vô ®ang thùc hiÖn
	local nMissionID = LIB_Award:GetValueByRate(tbDongHanhRate)
	gf_SetTaskByte(TSK_DONGHANH, 3, nMissionID)
	gf_SetTaskByte(TSK_DONGHANH_COUNT,1, gf_GetTaskByte(TSK_DONGHANH_COUNT,1) + 1)
	gf_SetTaskByte(TSK_DONGHANH_COUNT, 2, tbDongHanhName[nMissionID][2])
	Talk(1,"", szNPCName.."Hõm... §Ó xem h«m nay cho ng­¬i lµm viÖc g×...\nPh¶i råi, h·y <color=yellow>"..tbDongHanhName[nMissionID][1].."<color> nhÐ!")
	TaskTip("NhËn nhiÖm vô ®ång hµnh.")
	gf_WriteLogEx(szLogTitle, "nhËn", 1, "NhËn nhiÖm vô lÇn "..gf_GetTaskByte(TSK_DONGHANH_COUNT,1))
end
--===========================
function DongHanh_GetStatus()	-- LÊy tr¹ng th¸i hoµn thµnh nhiÖm vô. 0/1 Ch­a hoµn thµnh, hoµn thµnh
	return gf_GetTaskBit(TSK_DONGHANH, 25)
end

function DongHanh_SetStatus(nStatus)	-- Set tr¹ng th¸i hoµn thµnh nhiÖm vô.
	nStatus = nStatus or 1
	TaskTip("Hoµn thµnh nhiÖm vô ®ång hµnh, mau vÒ gÆp Long Quang Ch©n Nh©n.")
	gf_SetTaskBit(TSK_DONGHANH, 25, nStatus, 0)
	gf_SetTaskByte(TSK_DONGHANH, 3, 0)
	DongHanh_SetAward(1)
end
--===========================
function DongHanh_GetAward()	-- LÊy tr¹ng th¸i nhËn th­ëng mçi ngµy: 1 ®­îc nhËn th­ëng
	return gf_GetTaskBit(TSK_DONGHANH, 26)
end

function DongHanh_SetAward(nAward)	-- Set tr¹ng th¸i nhËn th­ëng mçi ngµy
	nAward = nAward or 1
	gf_SetTaskBit(TSK_DONGHANH, 26, nAward, 0)
end
--============================
function DongHanh_GetFinalAward()	-- LÊy tr¹ng th¸i nhËn th­ëng cuèi
	return gf_GetTaskBit(TSK_DONGHANH, 27)
end

function DongHanh_SetFinalAward(nAward)	-- Set tr¹ng th¸i nhËn th­ëng cuèi
	nAward = nAward or 1
	gf_SetTaskBit(TSK_DONGHANH, 27, nAward, 0)
end
--============================
function DongHanh_SetMissionPart()
	local nPart = gf_GetTaskByte(TSK_DONGHANH_COUNT, 2) - 1
	gf_SetTaskByte(TSK_DONGHANH_COUNT, 2, nPart)
	if nPart > 0 then
		TaskTip("Hoµn thµnh mét lÇn nhiÖm vô ®ång hµnh nµy, cßn "..nPart.." lÇn n÷a, h·y tiÕp tôc cè g¾ng.")
	end
end

function DongHanh_GetMissionPart()
	return gf_GetTaskByte(TSK_DONGHANH_COUNT, 2)
end