-- π¶ƒ‹Àµ√˜
-- ¥ÀΩ≈±æŒƒº˛ª·‘⁄ÕÊº“√ø¥ŒΩ¯»Î»Œ“‚“ª∏ˆ∑˛ŒÒ∆˜(ƒ‹ ∂±¥ÀŒƒº˛µƒ)∫Û◊‘∂Ø÷¥–– main ∫Ø ˝¿Ô√ÊµƒΩ≈±æ
-- ºÚµ•µƒÀµ£¨«–ªªµÿÕº°¢µ«¬Ω”Œœ∑∂ºª·÷¥––¥ÀΩ≈±æŒƒº˛÷– main ∫Ø ˝µƒƒ⁄»›

-- π¶ƒ‹ƒøµƒ
-- Õ®≥£ «◊˜Œ™ÕÊº“–¬’ ∫≈Ω®¡¢∫ÛΩ¯»Î”Œœ∑«∞≥ı ºªØ“ª–©∏ˆ»À–≈œ¢
-- ±»»Á◊‘∂Øº”‘ÿ≥ı º»ŒŒÒµ»


--ÃÌº”Õ∑Œƒº˛ ±«Î»∑±£»´æ÷±‰¡ø”Î∫Ø ˝≤ªª·≥ÂÕª°°ÃÌº”Õ∑Œƒº˛ ±«Î»∑±£»´æ÷±‰¡ø”Î∫Ø ˝≤ªª·≥ÂÕª
--ÃÌº”Õ∑Œƒº˛ ±«Î»∑±£»´æ÷±‰¡ø”Î∫Ø ˝≤ªª·≥ÂÕª	ÃÌº”Õ∑Œƒº˛ ±«Î»∑±£»´æ÷±‰¡ø”Î∫Ø ˝≤ªª·≥ÂÕª
--ÃÌº”Õ∑Œƒº˛ ±«Î»∑±£»´æ÷±‰¡ø”Î∫Ø ˝≤ªª·≥ÂÕª	ÃÌº”Õ∑Œƒº˛ ±«Î»∑±£»´æ÷±‰¡ø”Î∫Ø ˝≤ªª·≥ÂÕª
--ÃÌº”Õ∑Œƒº˛ ±«Î»∑±£»´æ÷±‰¡ø”Î∫Ø ˝≤ªª·≥ÂÕª	ÃÌº”Õ∑Œƒº˛ ±«Î»∑±£»´æ÷±‰¡ø”Î∫Ø ˝≤ªª·≥ÂÕª
--ÃÌº”Õ∑Œƒº˛ ±«Î»∑±£»´æ÷±‰¡ø”Î∫Ø ˝≤ªª·≥ÂÕª	ÃÌº”Õ∑Œƒº˛ ±«Î»∑±£»´æ÷±‰¡ø”Î∫Ø ˝≤ªª·≥ÂÕª
--Include([[\script\lib.lua]]);
Include("\\script\\task\\WeekEnd\\weekend_switch.lua");
Include("\\script\\online\\qingrenyuanxiao\\qryx_head.lua")
Include("\\script\\online\\laborday06\\laborday_head.lua");
Include("\\script\\online\\dragonboat06\\dragonboat_head.lua");
Include("\\script\\online\\dragonboat06\\mission_head.lua");
Include("\\script\\online\\plant\\tree_head.lua");
Include("\\script\\global\\mate_head.lua");
Include("\\script\\missions\\bw\\bwhead.lua");
Include("\\script\\online\\afterworldcup06\\hand_in_hand_head.lua");
Include("\\script\\shinynight_head.lua");
Include("\\script\\online\\zgc_public_fun.lua")
Include("\\script\\missions\\northwest_mission\\mission\\mission_head.lua")
Include("\\script\\global\\battlefield_callback.lua")
Include("\\script\\online\\qixi07\\qixi07_head.lua")
Include("\\script\\task\\lingshi_task.lua")
Include("\\script\\global\\c2s_execute_func.lua")
Include("\\script\\online\\viet_event\\new_year_09\\new_year_head.lua");

Include("\\script\\lib\\writelog.lua")
Include("\\script\\online\\viet_event\\200907\\eventopen.lua");--‘Ωƒœ09ƒÍ7‘¬ªÓ∂Øø™πÿÕ∑Œƒº˛
Include("\\script\\online\\viet_event\\200907\\event_head.lua");
Include("\\script\\online\\jpz_event\\first_tong\\first_tong_head.lua")
Include("\\script\\online\\viet_event\\200909\\event_head.lua");--09ƒÍ9‘¬÷–«ÔªÓ∂ØÕ∑Œƒº˛
Include("\\script\\task\\richangrenwu\\init_task.lua");--Œ‰¡÷ π’ﬂ»’≥£ªÓ∂ØÕ∑Œƒº˛
Include("\\script\\online_activites\\player_login_today.lua");
Include("\\script\\online_activites\\player_login_common.lua");
Include("\\script\\online_activites\\daily_reset.lua");
Include("\\script\\online_activites\\2010_12\\activity_05\\head.lua");
Include("\\script\\online_activites\\2010_12\\activity_06\\head.lua");

Include("\\script\\system_switch_config.lua") --gtask switch
Include("\\script\\task\\global_task\\gtask_head.lua") --new task
Include("\\script\\online\\liangshanboss\\lsb_head.lua")
Include("\\script\\online\\olympic\\oly_head.lua")
Include("\\script\\task\\global_task\\gtask_data.lua")
Include("\\script\\online\\qianhe_tower\\qht_head.lua")
Include("\\script\\online\\dazitie\\dzt_head.lua")
Include("\\settings\\static_script\\meridian\\item_julingwan.lua")
Include("\\script\\item\\item_yunling_box.lua")--«∑±‚∫–
Include("\\script\\function\\zq_battles\\zq_head.lua")
Include("\\settings\\static_script\\exchg_server\\exchgsvr_player_login.lua")
Include("\\script\\online\\tong_feast\\tf_head.lua")
Include("\\script\\online\\spring2014\\sp_head.lua")
Include("\\script\\online_activites\\2014_04\\wuxingfulongshu.lua")
Include("\\script\\task_access_code_def.lua")
Include("\\settings\\static_script\\meridian\\meridian_payer_login.lua")
Include("\\script\\misc\\observer\\observer_head.lua")
Include("\\settings\\static_script\\global\\merit.lua")
Include("\\script\\missions\\siling_trial\\slt_head.lua")
Include("\\script\\online\\item_buchang\\ibc_head.lua")

Include("\\script\\lib\\define.lua")
Include("\\script\\task_access_code_def.lua")
Include("\\script\\system_switch_config.lua")
Include("\\script\\lib\\writelog.lua")
Include("\\script\\online\\zgc_public_fun.lua")

--ÃÌº”Õ∑Œƒº˛ ±«Î»∑±£»´æ÷±‰¡ø”Î∫Ø ˝≤ªª·≥ÂÕª	ÃÌº”Õ∑Œƒº˛ ±«Î»∑±£»´æ÷±‰¡ø”Î∫Ø ˝≤ªª·≥ÂÕª
g_nBWAwardDate = 2014051200;	--±»Œ‰¥Ûª·Ω◊∂Œ–‘∑¢Ω±µƒΩ· ¯»’∆⁄
Include("\\script\\online\\viet_event\\nationality\\head.lua"); -- Server ID header
Include("\\script\\online\\viet_event\\ip_bonus\\ip_head.lua") -- IP bonus
Include("\\script\\online\\viet_event\\vng_task_control.lua"); -- VNG Task Control
Include("\\script\\online_activites\\task_values.lua"); -- KS Task Control
Include("\\script\\online\\chuyen_sinh\\translife_head.lua")  -- Chuyen sinh VN
Include("\\script\\online\\viet_event\\platinum_card\\platinum_head.lua") 
Include("\\script\\vng\\vanmay_daohuu\\vanmay_npc.lua") 
Include("\\script\\vng\\vng_playerlogin.lua")
Include("\\script\\biwudahui\\tournament\\tournament_head.lua")
g_szThisFile = "\\script\\global\\playerloginin.lua"

--∑µªÿ–«∆⁄º∏£¨0¥˙±Ì–«∆⁄ÃÏ
function GetWeekDay()
	return tonumber(date("%w"))
end;
--∑µªÿµ±«∞–° ±∫Õ∑÷÷”
function GetLocalTime()
	nHour = date("%H");
	nMin = date("%M");
	return tonumber(nHour), tonumber(nMin)
end;

--19 - 23µ„59∑÷
function CheckTime(day)

	--ªÓ∂Øø™πÿ
	if WEEKEND_SWITCH == 0 then
		return 0
	end;

	if day ~= GetWeekDay() then
		return 0
	end;

	local nBegin;
	local nEnd;
	if day == 0 then	--÷‹»’ «œ¬ŒÁ2£∫00 - ÕÌ…œ10£∫00
		nBegin = 14 * 60;
		nEnd = 22 * 60;
	else
		nBegin = 19 * 60;	--∆‰À˚»’◊” «ÕÌ…œ7£∫00µΩÕÌ…œ12£∫00
		nEnd = 24 * 60;
	end;

	local nHour, nMin = GetLocalTime();
	local nValue = nHour * 60 + nMin;
	if nValue >= nBegin and nValue <= nEnd then
		return 1
	else
		return 0
	end;
end;

function ItemLockAlert()
	local isfirst, haveitemunlock, bForceUnlock = GetItemLockStatus()
	if isfirst > 0 then
		Say("H÷ thËng kh„a vÀt ph»m giÛp b∂o qu∂n tµi kho∂n \n Trong hµnh trang th™m nÛt kh„a vÀt ph»m, chÿ c«n thi’t lÀp mÀt m∑ ban Æ«u lµ c„ th” kh„a vÀt ph»m. ß” bi’t th™m chi ti’t nh n F1.", 0)
	end

	if haveitemunlock > 0 then
		Msg2Player("Bπn hi÷n c„ vÀt ph»m Æang mÎ kh„a")
	end

	if bForceUnlock > 0 then
		Msg2Player("Trang bﬁ kh„a Æang Î trπng th∏i chÿ Æﬁnh mÎ")
	end
end

function main(ExchangeComing)
	local nPlayerRoute = GetPlayerRoute();
	--NOTE: it MUST be the 1st one calling for resetting things by SunZhuoshi
	--< Added by SunZhuoshi
	DR_OnPlayerLogin();
	PLT_OnPlayerLogin();
	--PLC_OnPlayerLogin();
	-->
--	SB_OnPlayerLogin();
	FG_OnPlayerLogin();
	-->

	LearnSkill(11)	--—Ó√≈ººƒ‹11
	LearnSkill(12)	--—Ó√≈ººƒ‹12
	local nDate = tonumber(date("%Y%m%d"))
	-- ≤ÿΩ£…Ω◊Ø£¨∂œœﬂ∫Û÷ÿ–¬¡¨Ω”ªÿ≥«¥¶¿Ì
	RemoveTrigger(GetTrigger(1101))
	RemoveTrigger(GetTrigger(1102))
	RemoveTrigger(GetTrigger(1103))
	RemoveTrigger(GetTrigger(1104))
	if GetTrigger(2517) ~= 0 then
		RemoveTrigger(GetTrigger(2517));
	end;
	if GetTrigger(2518) ~= 0 then
		RemoveTrigger(GetTrigger(2518));
	end;
	if GetTrigger(2519) ~= 0 then
		RemoveTrigger(GetTrigger(2519));
	end;
	local nMapID, nX, nY = GetWorldPos()
	if ((nMapID >= 1011) and (nMapID <= 1059)) or ((nMapID >= 2011) and (nMapID <= 2059)) or ((nMapID >= 3011) and (nMapID <= 3059))or ((nMapID >= 4011) and (nMapID <= 4059))or ((nMapID >= 5011) and (nMapID <= 5059)) then  --≤ÿΩ£µÿÕº«¯º‰
		print("#Tµng Ki’m s¨n trang: Ng≠Íi ch¨i ["..GetName().."] xu t hi÷n s˘ cË kh∏c th≠Íng, Æ¯t k’t nËi server, bﬁ chuy”n v“ thµnh.")
		NewWorld(350,1397,2852)
		SetFightState(0)
	end

	-- …æ≥˝”¢–€¡ÓµƒµÙ¬‰
	if (GetTrigger(100)~=0 and GetTask(1152) == 0) then
		SetTask(1152,1)
		RemoveTrigger(GetTrigger(100))
	end
	RemoveTrigger(GetTrigger(555))
	if GetTrigger(2509) ~= 0 then
		RemoveTrigger(GetTrigger(2509))
	end
	if GetTrigger(2516) ~= 0 then
		RemoveTrigger(GetTrigger(2516))
	end

	--π´≤‚ ±"Ω±»Ø"µÙ¬‰¥•∑¢…Ë÷√
	RemoveTrigger(GetTrigger(260));	--2008ƒÍ7‘¬31»’»•µÙΩ±»ØµÙ¬‰
	--================================================================
	--05ƒÍ •µÆªÓ∂Ø
	if (nDate >= 20051223 and nDate <= 20051228) then
		if GetTrigger(3000) == 0 then
			CreateTrigger(0,1200,3000);
		end
			Msg2Player("Hoπt ÆÈng l‘ gi∏ng sinh Æ∑ bæt Æ«u, h∑y Æ’n Truy“n gi∏o s‹ Î c∏c thµnh thﬁ ch›nh tra xem th´ng tin cÙ th”!")
	else
		if GetTrigger(3000) ~= 0 then
			RemoveTrigger(GetTrigger(3000));
		end;
	end
	--================================================================
	--06ƒÍ‘™µ©ªÓ∂Ø
	--“ÚŒ™¥∫Ω⁄ªÓ∂Ø“≤”–…æ≥˝∏˙∞‡µƒ≤Ÿ◊˜£¨À˘“‘œ¬√ÊµƒKillFollower‘⁄¥∫Ω⁄ªÓ∂Ø∆⁄º‰“™◊¢ ÕµÙ
	--KillFollower()	--»∑±£…œœﬂ/øÁ∑˛µƒ ±∫Ú√ª”–∏˙∞‡
	RemoveTitle(3,3)	--»∑±£…œœﬂ/øÁ∑˛µƒ ±∫Ú√ª”–°∞Ô⁄∆Ï‘⁄¥À£°°±µƒ≥∆∫≈
	if (nDate >= 20051231 and nDate <= 20060105) then
		local mapID = GetWorldPos()
		if mapID == 108 or mapID == 201 or mapID == 304 then
			SetDeathPunish(0)	--‘⁄ªÓ∂Ø∆⁄º‰»∑±£…œœﬂ/øÁ∑˛µƒ ±∫Ú£¨Ω¯»Î∂·∆ÏµÿÕº√ª”–À¿Õˆ≥Õ∑£°£
		end
		local bCreateFailed = 0	--”√¿¥º«¬º¥•∑¢∆˜ «∑Ò¥¥Ω®≥…π¶
		if CreateTrigger(2,1700,3200) == 0 then	--Ω¯»Î»™÷›∂·∆Ï±»»¸µÿÕº¥•∑¢∆˜
			bCreateFailed = 1
		end
		if CreateTrigger(2,1701,3201) == 0 then	--¿Îø™»™÷›∂·∆Ï±»»¸µÿÕº¥•∑¢∆˜
			bCreateFailed = 1
		end
		if CreateTrigger(2,1702,3202) == 0 then	--Ω¯»Î„Íæ©∂·∆Ï±»»¸µÿÕº¥•∑¢∆˜
			bCreateFailed = 1
		end
		if CreateTrigger(2,1703,3203) == 0 then	--¿Îø™„Íæ©∂·∆Ï±»»¸µÿÕº¥•∑¢∆˜
			bCreateFailed = 1
		end
		if CreateTrigger(2,1704,3204) == 0 then	--Ω¯»Î≥…∂º∂·∆Ï±»»¸µÿÕº¥•∑¢∆˜
			bCreateFailed = 1
		end
		if CreateTrigger(2,1705,3205) == 0 then	--¿Îø™≥…∂º∂·∆Ï±»»¸µÿÕº¥•∑¢∆˜
			bCreateFailed = 1
		end

		if bCreateFailed == 1 then
			Msg2Player("Bπn kh´ng th” tham d˘ hoπt ÆÈng T’t Nguy™n ß∏n trong l«n Æ®ng nhÀp nµy! H∑y thˆ Æ®ng nhÀp lπi!")
		else
			Msg2Player("Hoπt ÆÈng T’t Nguy™n ß∏n Æ∑ bæt Æ«u! ThÍi gian hoπt ÆÈng bæt Æ«u tı 31/12/2005 Æ’n 5/1/2006 k’t thÛc.")
			--TaskTip("«ÎµΩ„Íæ©∏Æƒœ°¢≥…∂º∏Æƒœ°¢»™÷›∏Æ±±µƒ∂·∆ÏΩÃÕ∑¥¶¡ÀΩ‚∂·∆Ï»¸œ∏‘Ú°£")
		end
	else
		for i = 3200,3205 do
			if GetTrigger(i) ~= 0 then
				RemoveTrigger(GetTrigger(i))
			end
		end;
	end
	--================================================================
	--06ƒÍ¥∫Ω⁄ªÓ∂Ø
	if GetWorldPos() == 961 or GetWorldPos() == 962 or GetWorldPos() == 963 or GetWorldPos() == 964 or GetWorldPos() == 965 then
		SetDeathPunish(0)	--…œœﬂµΩ—©’ÃµÿÕº ±£¨ŒﬁÀ¿Õˆ≥Õ∑£
		for SkillID=843,851 do
			LearnSkill(SkillID)	--…œœﬂµΩ—©’ÃµÿÕº ±—ßª·¥Ú—©’Ãººƒ‹
		end
		SetDeathScript("\\script\\online\\¥∫Ω⁄ªÓ∂Ø\\playerdeath.lua")
		UseScrollEnable(0)
	end

	if (nDate >= 20060120 and nDate <=20060205) then
		if CreateTrigger(0,1201,3100) == 0 then
			Msg2Player("Bπn Æ∏nh qu∏i kh´ng r¨i ra vÀt li÷u lµm b∏nh trong l«n Æ®ng nhÀp nµy. H∑y thˆ Æ®ng nhÀp lπi!")
		end

		local id,idx = 0,0
		bCreateFailed = 0
		for i=1,5 do
			Tid = 1710 + i
			Tidx = 3100 + i
			if CreateTrigger(2,Tid,Tidx) == 0 then	--¥¥Ω®¿Îø™µÿÕº¥•∑¢∆˜
				bCreateFailed = 1
			end
		end
		if bCreateFailed == 1 then
			Msg2Player("Bπn kh´ng th” tham gia n–m tuy’t b◊nh th≠Íng trong l«n Æ®ng nhÀp nµy. H∑y thˆ Æ®ng nhÀp lπi!")
			WriteLog("[Hoπt ÆÈng mÔa xu©n -K’t nËi th t bπi]:"..GetName().."ß®ng nhÀp/m t k’t nËi server rÍi kh·i bÈ k’t nËi map (3101-3105).")
		end
	else
		for i=3100,3105 do
			if GetTrigger(i) ~= 0 then
				RemoveTrigger(GetTrigger(i))
			end
		end
		local MapID = GetWorldPos()
		local Map_Pos = {
					{961,300,1820,3573},
					{962,200,1409,3048},
					{963,100,1365,2932},
					{964,350,1575,2970},
					{965,150,1781,3154}
					}
		for i=1,5 do
			if MapID == Map_Pos[i][1] then	--»Áπ˚≤ª‘⁄ªÓ∂Ø∆⁄º‰…œœﬂµΩ—©’ÃµÿÕº£¨‘Ú¥´ÀÕ≥ˆ»•°£
				NewWorld(Map_Pos[i][2],Map_Pos[i][3],Map_Pos[i][4])
				if GetWorldPos() == Map_Pos[i][2] then
					SetDeathPunish(1)
					SetFightState(0)
					UseScrollEnable(1)
					SetTempRevPos(0,0,0)
					for SkillID=843,851 do
						if HaveLearnedSkill(SkillID) == 1 then
							RemoveSkill(SkillID)	--Õ¸º«¥Ú—©’Ãººƒ‹
						end;
					end
					SetDeathScript("")
					break
				end
			end
		end
	end

	--================================================================
	--06ƒÍ«È»ÀΩ⁄£¶‘™œ¸Ω⁄ªÓ∂Ø(‘Ωƒœ∞Ê)
	if Is_QRYX_Activity() == 1 and GetSex() == 2 then
		CreateTrigger(0,1202,3110);					-- ¥Úπ÷µÙ¬‰«…øÀ¡¶µƒ¥•∑¢∆˜
	elseif GetTrigger(3110) ~= 0 then
		RemoveTrigger(GetTrigger(3110))
	end
	--================================================================

	--08ƒÍ«Â√˜Ω⁄ªÓ∂Ø
	if nDate <= 20080412 then
		Msg2Player("Hoπt ÆÈng ti’t Thanh Minh Æ∑ bæt Æ«u, c∏c hi÷p kh∏ch h∑y Æ’n D…n LÈ nh©n g«n D∑ T»u Æ” bi’t th´ng tin chi ti’t!");
	else	--∑««Â√˜Ω⁄ªÓ∂Ø∆⁄º‰…œœﬂµΩ∞›º¿µÿÕº ±£¨◊‘∂Ø¥´ÀÕÕÊº“≥ˆ»•
		local Map_Pos_QM = {
					{818,100,1458,2807},
					{819,200,1170,2828},
					{820,300,1640,3526},
					}
		local MapID_QM = GetWorldPos();
		for i=1,getn(Map_Pos_QM) do
			if MapID_QM == Map_Pos_QM[i][1] then
				NewWorld(Map_Pos_QM[i][2],Map_Pos_QM[i][3],Map_Pos_QM[i][4]);
				break;
			end;
		end;
	end;
	--================================================================
	--06ƒÍŒÂ“ªΩ⁄ªÓ∂Ø
	----- boss∫Õ…Ãª·»ŒŒÒ µ«¬Ωπ´∏Ê----
	local nDate = tonumber(date("%Y%m%d"))
	if nDate >= 20060428 and nDate <= 20060430 then
		Msg2Player("21:30 tËi nay, boss M∑ T∆c Æ«u mÙc xu t hi÷n g«n t©y Bi÷n Kinh c≠Ìp m t 1 con Tu n M∑, Æ∑ Æ’n lÛc c∏c hi÷p kh∏ch trı hπi cho d©n!")
		Msg2Player("Ph«n th≠Îng Nhi÷m vÙ Th≠¨ng hÈi h´m nay r t phong phÛ! Nhi÷m vÙ th¯ 10 vﬂng 2 vµ nhi÷m vÙ th¯ 10 vﬂng 3 Æ“u c„ ph«n th≠Îng lÌn chÍ ÆÓi bπn!")
	end
	--================================================================
	--06ƒÍ∂ÀŒÁΩ⁄ªÓ∂Ø
	if GetTask(1715) == 2 then
		WriteLog("Do tho∏t game ÆÈt ngÈt, d…n Æ’n ng≠Íi ch¨i"..GetName().."Thay ÆÊi nhi÷m vÙ sË 1715 ch≠a reset, v◊ th’ khi Æ®ng nhÀp c«n ti’n hµnh kh´i phÙc trπng th∏i cho ng≠Íi ch¨i.")
		Restore_Player_State();
	end;
	local nGenre,nDetail,nParticular = GetPlayerEquipInfo(10);
	local bOnBoat = 0;
	if nGenre == 0 and nDetail ==105 then
		for i=25,31 do
			if nParticular == i then
				bOnBoat = 1;
				break;
			end;
		end;
	end;
	if bOnBoat == 1 then
		UnEquipAtPosition(10);
	end;

	for i=854,859 do
		if HaveLearnedSkill(i) == 1 then
			RemoveSkill(i);
		end;
	end;
	if Get_DragonBoatDay_State() == 3 then
		bCreateFailed = 0;
		for i=0,5 do
			Tid = 1107 + i
			Tidx = 3113 + i
			if GetTrigger(Tidx) == 0 then
				if CreateTrigger(2,Tid,Tidx) == 0 then	--¥¥Ω®Ω¯»Î¿Îø™÷÷ ˜µÿÕº¥•∑¢∆˜
					bCreateFailed = 1	--ƒ≥“ª∏ˆ¥•∑¢∆˜¥¥Ω® ß∞‹¡À
				end
			end;
		end;
		if bCreateFailed == 1 then
			Msg2Player("L«n Æ®ng nhÀp nµy khi’n bπn kh´ng th” ti’n hµnh trÂng c©y b◊nh th≠Íng! Vui lﬂng Æ®ng nhÀp lπi!")
			WriteLog("[Hoπt ÆÈng Th∏i H≠ Qu∂ ThÙ (K’t nËi th t bπi)]:"..GetName().."ß®ng nhÀp/m t k’t nËi server rÍi kh·i bÈ k’t nËi map (3113-3118).")
		end
	else
		for i = 3113,3118 do
			if GetTrigger(i) ~= 0 then
				RemoveTrigger(GetTrigger(i))
			end
		end;
	end;
	SetDeathScript("");
	SetTask(TASK_TREEINDEX,0);	--
	SetTask(TASK_TREEGROW,0);	--
	SetTask(TASK_PLANTTIME,0);
	--================================================================
	--–Ø ÷ ¿ΩÁ±≠ªÓ∂Ø
	if GetTrigger(3119) ~= 0 then
		RemoveTrigger(GetTrigger(3119));
	end;
--	if GetTask(TASK_GOTPET_TIME) ~= 0 and GetTime() - GetTask(TASK_GOTPET_TIME) > 60*60*24 then
--		KillFollower();
--		SetTask(TASK_GOTPET_TIME,0);
--	end;
	--================================================================
	--∂‡»À¿ﬁÃ®
	for i=1,getn(MultiMapTab) do
		if GetWorldPos() == MultiMapTab[i][1] then
			NewWorld(300,1832,3582)
		end
	end

	for i=1,getn(SingleTeamMapTab) do
		if GetWorldPos() == SingleTeamMapTab[i][1] then
			NewWorld(300,1832,3582)
		end
	end

	for i=1,getn(TeamMapTab) do
		if GetWorldPos() == TeamMapTab[i][1] then
			NewWorld(300,1832,3582)
		end
	end

	if GetTask(1151) == 1 then
		SetPlayerState(3);
		SetTask(1151,0);
	end
	--================================================================
	--÷‹ƒ©ªÓ∂Ø
	if WEEKEND_SWITCH == 1 then
		if GetTrigger(2000) == 0 then
			CreateTrigger(0, 1000, 2000);
		end;
	else
		if GetTrigger(2000) ~= 0 then
			RemoveTrigger(GetTrigger(2000));
		end;
	end;
	--================================================================
	--¥Û¿Ì»ŒŒÒ√Ê∞Â≥ˆ¥Ì–ﬁ’˝
	if GetTask(1314) >= 2 and (GetTask(1312) == 5 or GetTask(1313) == 4) then
		SetTask(1312,6);
		SetTask(1313,5);
	end
	--================================================================
	--Œ˜±±»ŒŒÒÃ· æ
	if GetLevel() >= 70 and GetTask(2030) == 0 then
		Msg2Player("G«n Æ©y Kh u chu»n Bi÷n Kinh nhÀn Æ≠Óc tin Nh t Ph»m ß≠Íng Æ∑ hµnh ÆÈng tπi bi™n giÌi T©y Bæc Æπi TËng, bªng h˜u cÚng c„ danh ti’ng tr™n giang hÂ. Xin ra tay giÛp ÆÏ.");
	end

	--‘˘ÀÕŒ˜”ÚÃΩ√ÿ√≈∆±Ã· æ
	if GetTask(2031) >= 68 then
		give_xibei_ticket()
		if random(1,100) <= 33 then
			Msg2Player("ßπi TËng v◊ muËn ti÷n cho c∏c Æπi hi÷p tr™n Æ≠Íng v≠Ót ∂i th«n b› Æ∑ ph∏i 1 MÀt s¯ Î PhÙng T≠Íng phÒ giÛp Æ≠a c∏c Æπi hi÷p Æ’n n¨i th«n b›, h∑y Æ’n PhÙng T≠Íng (219, 196) Æ” t◊m hi”u.")
		end
	end

	if GetTask(101) ~= 874 then
		remove_oldquest()	-- …æ≥˝‘≠ ¿ΩÁ»ŒŒÒ
	end

	if (IsInGatherMap() == 1) then
		SetInGatherMap(1)
	else
		SetInGatherMap(0)
	end

	if GetTask(1) == 0 then
	    SetTask(1, 100);
	    TaskTip("H≠Ìng d…n nhi÷m vÙ t©n thÒ: B∏i ki’n D∑ T»u");
	end;

	if GetTask(111) > 0 and GetTask(111) < 100 then
	    SetTask(111, 0);
	end;

	if GetTask(121) > 0 and GetTask(121) < 100 then
	    SetTask(121, 0);
	    SetTask(122, 0);
	end;
	--================================================================
	-- ª‘ªÕ÷Æ“πÃ· æ
	ShowShinyNightMsg()
	--================================================================
	--¿Œ∑øœ‡πÿ
	if GetWorldPos() == 701 then
		SetCanRestorePK(1);	--4±∂ÀŸ∂»œ˚PK÷µ
		UseScrollEnable(0);	--≤ªƒ‹ π”√ªÿ≥«∑˚
		ForbidRead(1);	--≤ªƒ‹–ﬁ È
	end;

	-- ≥« –¿Œ∑øœ‡πÿ
	if GetWorldPos() >= 730 and GetWorldPos() <= 734 then
		StallEnable(0)	-- ≤ªƒ‹∞⁄ÃØ
		ForbidRead(1)	--≤ªƒ‹–ﬁ È
		UseScrollEnable(0)	--Ω˚÷π π”√ªÿ≥«
		SetFightState(0)
		ContinueTimer(GetTrigger(261))
	end
	--================================================================
	--’Ω≥°œ‡πÿ
	if GetTask(800) == 0 then	--–¬’Ω≥°±‰¡ø«Â≥˝
		for i=701,799 do
			if i ~= 747 then
				SetTask(i,0);
			end;
		end;
		SetTask(800,1);
	end;
	CalcBattleRank()	--…Ë÷√’Ω≥°æ¸œŒ
	UpdateBattleMaxRank()
	VerifyEquip()		-- ºÏ≤‚◊∞±∏¥©…œ»• «∑Ò”––ß
	if GetTask(741) == 1 then
		KillFollower();
		SetTask(741,0)
	end;
	--================================================================
	--Ω·ªÈœ‡πÿ
	UnSedan()	-- œ¬ª®ΩŒ
	OnDoll()	-- º§ªÓÃÊ…ÌÕﬁÕﬁ
	--================================================================
	Del_overdue_goods();	--…æ≥˝π˝∆⁄ŒÔ∆∑
	--¥Â≥§µƒµ«¬Ω÷¥––∫Ø ˝
	Zgc_login_fun_main()
	--================================================================
	--Õ√–°—æ¥Ã‚øÚœ˚ ß±Í÷æŒª«Âø’
	SetTask(615,0)
	SetTask(629,0)  -- ’∑—∞Ê «628 IB∞Ê «629
	--================================================================
	--07∆ﬂœ¶ªÓ∂Ø
	local nQixiDate = tonumber(date("%Y%m%d"))
	if nQixiDate >= 20070816 and nQixiDate <= 20070830 then
		Msg2Player("Hoπt ÆÈng Th t tﬁch Æ∑ khai mπc, b∏ch Hoa s¯ gi∂ khæp n¨i Î trung t©m Bi÷n Kinh , Thµnh ß´, Tuy“n Ch©u Æ∑ chu»n bﬁ v´ sË l‘ vÀt cho t◊nh nh©n trong dﬁp l‘ l∑ng mπn nµy, mau mau Æ’n xem!")
	end

	flower_time();
	--================================================================
	--“∆≥˝“—æ≠∑œ÷πµƒººƒ‹: "ªÏ„Á»≠∑®"
	if HaveLearnedSkill("HÁn ßÈn quy“n ph∏p") == 1 then
		RemoveSkill("HÁn ßÈn quy“n ph∏p")
	end
	--================================================================
	--========¡È Ø»ŒŒÒ==============
	if GetTask(TASK_LINGSHI_ID) == 0 then
		--talk_I();
	elseif GetLevel() >= 80 and GetTask(689) == 0 then	--µ»º∂¥Û”⁄µ»”⁄80º∂£¨µ⁄“ª¥Œµ«¬Ω
		local tbBWSay = {
					"Ta muËn Æ’n chÁ b∏o danh/go_to_biwudahui",
					"ß” ta suy ngh‹/nothing",
					}
		Say("<color=green>Minh ChÒ Kim S¨n<color>: Nhªm tπo n™n mÈt giang s¨n th∏i b◊nh thﬁnh trﬁ, tri“u Æ◊nh kh´ng ngıng xem tr‰ng vÚ trang. ß” bi™n c≠¨ng kh´ng bﬁ x©m l≠Óc vµ Æ” vang danh sa tr≠Íng, ßπi hÈi t˚ v‚ Thi™n Hπ ß÷ Nh t ch›nh th¯c bæt Æ«u.",getn(tbBWSay),tbBWSay);
		SetTask(689,1,TASK_ACCESS_CODE_BIWUDAHUI);
	elseif GetLevel() >= 70 and GetTask(544) == 0 then --µ»º∂¥Û”⁄µ»”⁄70º∂£¨µ⁄“ª¥Œµ«¬Ω
		Talk(1,"about_suohun","<color=red>Nhæc nhÎ quan tr‰ng<color>: V‚ l©m truy“n k˙ 2 th™m bi÷n ph∏p an toµn mÌi, m‰i ng≠Íi c«n chÛ ˝:\nTh™m <color=red> n kh„a hÂn<color>, kh„a vÀt ph»m hi÷n tπi ph©n 2 loπi, <color=red>Kh„a th≠Íng<color> vµ <color=red>Kh„a hÂn vÀt ph»m<color>.\n<color=red>Kh„a th≠Íng<color> lµ ch¯c n®ng kh„a vÀt ph»m Æ∑ mÎ, vÀt ph»m kh„a kh´ng th” giao dﬁch, n–m b·, b∏n ti÷m vµ lµm c∏c thao t∏c Æ∆c bi÷t.\n<color=red> n kh„a hÂn<color> t¯c lµ th™m ch¯c n®ng an toµn. VÀt ph»m kh„a hÂn <color=red>c„ th” giao dﬁch<color>, nh≠ng <color=red>kh´ng th”<color> n–m b·, b∏n ti÷m vµ lµm c∏c thao t∏c Æ∆c bi÷t.");
	elseif GetTask(549) == 0 then
		Say("    V‚ l©m truy“n k˙ 2 ch›nh th¯c c´ng bË ch¯c n®ng <color=yellow>T˘ t◊m Æ≠Íng<color>. T˘ t◊m Æ≠Íng, t◊m NPC, t◊m ng≠Íi ch¨i, d‘ sˆ dÙng.\n    Nh n ph›m '<color=red>G<color>' mÎ b∂n ÆÂ lÌn: T◊m Æﬁa Æi”m ho∆c nh n c∏c b∂n ÆÂ nh· Æ” vµo, d‘ dµng Æ’n Æﬁa Æi”m b t k◊ tr™n b∂n ÆÂ; CÚng c„ th” t◊m t™n NPC Æ” t˘ t◊m Æ’n NPC. Nh n ph›m '<color=red>H<color>', c„ th” mÎ toµn c∂nh b∂n ÆÂ nh· Æ’n vﬁ tr› b t k˙ tr™n b∂n ÆÂ.\n    C„ th” 'T◊m ng≠Íi' qua danh s∏ch h∂o h˜u ho∆c cıu nh©n, danh s∏ch t∏n g…u Æ” t◊m vﬁ tr› ng≠Íi ch¨i.",0);
		SetTask(549,1);
--	elseif GetTask(443) == 0 then
--		Say("ThÍi gian x∏c nhÀn 5 giÍ ch¨i Æ∑ h’t, xin Æ®ng nhÀp vµo <color=yellow>http://volam2.zing.vn Æ” Æ®ng k˝ th´ng tin.",0);
--		SetTask(443,1);
	end;
	--========≥« –≥∆∫≈==============
	local tTongCityTitle =
	{
		[100] = {5,6,7,8},
		[300] = {1,2,3,4},
		[350] = {9,10,11,12},
	}
	local szPlayerName_CityWarUse = GetName()
	for index, value in tTongCityTitle do
		local szSelfTong = GetTongName()
		local szTongName, _2, _3, nCityEndTime = GetCityWarInfo(index, "base")
		for i=1, 4 do
			if IsTitleExist(51, value[i]) > 0 then
				if szTongName == nil or szTongName ~= szSelfTong then
					RemoveTitle(51, value[1])
					RemoveTitle(51, value[2])
					RemoveTitle(51, value[3])
					RemoveTitle(51, value[4])
					break
				else
					if i == 1 or i == 2 then	-- ≥«÷˜orø§÷˜
						local nCount, szBoss = GetCityWarInfo(index, "boss")
						if szBoss ~= szPlayerName_CityWarUse then
							RemoveTitle(51, value[1])
							RemoveTitle(51, value[2])
							RemoveTitle(51, value[3])
							RemoveTitle(51, value[4])
						end
					elseif i == 3 then			-- æ¸ ¶
						local nCount, szManager = GetCityWarInfo(index, "manager")
						if szManager ~= szPlayerName_CityWarUse then
							RemoveTitle(51, value[1])
							RemoveTitle(51, value[2])
							RemoveTitle(51, value[3])
							RemoveTitle(51, value[4])
						end
					elseif i == 4 then			-- √˚≤∂
						local nCount, sF1, sF2, sF3, sF4 = GetCityWarInfo(index, "fighter")
						if not (sF1 == szPlayerName_CityWarUse or
							sF2 == szPlayerName_CityWarUse or
							sF3 == szPlayerName_CityWarUse or
							sF4 == szPlayerName_CityWarUse) then
								RemoveTitle(51, value[1])
								RemoveTitle(51, value[2])
								RemoveTitle(51, value[3])
								RemoveTitle(51, value[4])
						end
					end
				end
				break
			end
		end
	end
	--========µ⁄“ª¥ŒΩ¯»Î”Œœ∑∏¯”Ë∞› ¶Ã˚=========
	if CustomDataRead("mp_p_give_baishitie") == nil then
		AddItem(2,1,587,1,1)
		CustomDataSave("mp_p_give_baishitie", "d", 0)
	end
	--=============¥¢ŒÔœ‰º”“≥============================
	if GetTask(TASK_CHUWUXIANG_JIAYE) ~= 1 and GetTask(805) >= 2 and GetStoreBoxPageCount() <= 4 then
		SetStoreBoxPageCount(GetStoreBoxPageCount()+1);
		SetTask(TASK_CHUWUXIANG_JIAYE,1);
		Msg2Player("Toµn th” nh©n vi™n V‚ L©m 2 chÛc bπn ch¨i vui vŒ, chÛng t´i t∆ng bπn th™m 1 R≠¨ng ch¯a ÆÂ, chÛc bπn k’t th™m nhi“u bπn mÌi.");
	end
	--===============08»˝∞ÀΩ⁄================================
	if GetTask(2407) ~= 0 and GetTime() - GetTask(2407) > 60*60*24 then
		KillFollower();
		SetTask(2407,0);
	end;
	if GetTask(444) == 0 and nPlayerRoute == 21 then	--»Áπ˚ «π∆ ¶µ⁄“ª¥Œ…œœﬂ
		AddItem(2,0,1063,1);	--∏¯À˚“ª∏ˆ…ÒƒæÕı∂¶
		Msg2Player("Bπn nhÀn Æ≠Óc 1 Th«n MÈc V≠¨ng ßÿnh");
		TaskTip("Bπn nhÀn Æ≠Óc 1 Th«n MÈc V≠¨ng ßÿnh");
		SetTask(444,1);
	end;
	if nPlayerRoute == 21 then
		sync_guinsect_num_in_guding();	--Õ¨≤Ωπ∆ ¶π∆∂¶¿Ô√Êµƒπ∆µƒ ˝¡ø∏¯øÕªß∂À
	end;
	
	--øÁ∑˛…œœﬂ≤Ÿ◊˜
	exchgsvr_on_player_login()--‘Áµ„◊ˆ
	
	process_biwudahui();	--¥¶¿Ì±»Œ‰¥Ûª·œ‡πÿƒ⁄»›
	process_shimenguanka();	--¥¶¿Ì ¶√≈πÿø®œ‡πÿƒ⁄»›
	process_ip_issue();		--”Î…œ¥Œµ«¬ΩIP≤ªÕ¨ ±∏¯Ã· æ


	--===================================¥¥Ω®Ω¯»Î¿Îø™¡˙»™¥ÂµÿÕº¥•∑¢∆˜(ÃÏœ¬µ⁄“ª∞Ô)======================================
	first_tong_pk_config();
--	AddItemForViet200906()
--	AddItemForViet200909()
	AddItemForViet200911()
    	AddItemForViet200912()
-- B∂o v÷ R≠¨ng Tµi Nguy™n
	local nDate = tonumber(date("%w"))
	if nDate == 3 then
		if GetTrigger(3204) == 0 then
			if CreateTrigger(2,1704,3204) == 0 then	--Ω¯»Î≥…∂º∂·∆Ï±»»¸µÿÕº¥•∑¢∆˜
				WriteLog(GetName().." CreateTrigger 1704 failed")
			end
		end
		if GetTrigger(3205) == 0 then
			if CreateTrigger(2,1705,3205) == 0 then	--¿Îø™≥…∂º∂·∆Ï±»»¸µÿÕº¥•∑¢∆˜
				WriteLog(GetName().." CreateTrigger 1705 failed")
			end
		end
	else
		for i = 3204,3205 do
			if GetTrigger(i) ~= 0 then
				RemoveTrigger(GetTrigger(i))
			end
		end;
	end

     --»°≥ˆ»’≥£ªÓ∂Øµƒ¿‡–Õ
     set_ruchangrenwu_type()
	
	if GetPlayerRoute() ~= 0 then
		local nDate = tonumber(date("%w%H"))
		if nDate >= 319 and nDate < 320 then
			local nMapID, nX, nY = GetWorldPos()
			if nMapID == 304 then
				local szTongName, nCessBuysell, nCessStore, nTime = GetCityWarInfo(300, "base")
				if IsTongMember() == 0 or GetTongName() ~= szTongName then
					LeaveTeam()
					local nFlag = random(1,2)
					SetPKFlag(1,nFlag)
					ForbidChangePK(1)
					SetTaskTemp(105,1)
				end
			end
		end
	end
	
-- reset VNG TaskID	
	ResetTask()
	removeLiangshan()
	
-- VNG clear event item
	DelEventItem()
		
-- VNG IP Bonus
	IpBonusReset()
	IpBonusStart()
	
-- Server ID
--	get_server_id()
	vng_set_nationality()
	if gf_GetTaskByte(TSK_SERVER_ID, TSK_SERVER_ID_CUR) == 49 then
		gf_SetTaskByte(TSK_SERVER_ID, TSK_SERVER_ID_CUR, 52)
		return
	elseif  gf_GetTaskByte(TSK_SERVER_ID, TSK_SERVER_ID_CUR) == 45 then
		gf_SetTaskByte(TSK_SERVER_ID, TSK_SERVER_ID_CUR, 53)
		return
	elseif  gf_GetTaskByte(TSK_SERVER_ID, TSK_SERVER_ID_CUR) == 54 then
		gf_SetTaskByte(TSK_SERVER_ID, TSK_SERVER_ID_CUR, 50)
		return
	elseif gf_GetTaskByte(TSK_SERVER_ID, TSK_SERVER_ID_CUR) == 30 then
		gf_SetTaskByte(TSK_SERVER_ID, TSK_SERVER_ID_CUR, 12)
		return
	elseif  gf_GetTaskByte(TSK_SERVER_ID, TSK_SERVER_ID_CUR) == 46 then
		gf_SetTaskByte(TSK_SERVER_ID, TSK_SERVER_ID_CUR, 16)
		return
	elseif  gf_GetTaskByte(TSK_SERVER_ID, TSK_SERVER_ID_CUR) == 51 then
		gf_SetTaskByte(TSK_SERVER_ID, TSK_SERVER_ID_CUR, 17)
		return
	end
	
--	if gf_GetTaskByte(TSK_SERVER_ID,1) ~= GetGlbValue(GLB_TSK_SERVER_ID) then
--		gf_SetTaskByte(TSK_SERVER_ID,1,GetGlbValue(GLB_TSK_SERVER_ID))
--	end
	
-- Add Ti’u Ngπo Giang HÂ LÙc n’u ch≠a c„
	if GetItemCount(2, 1, 30240) < 1 then
		AddItem(2, 1, 30240, 1)
		Msg2Player("Bπn nhÀn Æ≠Óc 1 quy”n Ti’u Ngπo Giang HÂ LÙc!")
	end	
	
-- Th´ng b∏o sˆ dÙng Æ«u thµnh
	if GetTask(2154) > 0 then
		TaskTip("Bπn Æ∑ k›ch hoπt sˆ dÙng ß«u Thµnh T›n, ß«u Thµnh Th≠, ß«u Thµnh Bi”u. ß” hÒy b· k›ch hoπt h∑y Æ’n Bi÷n Kinh t◊m Tri÷u PhÊ.")
	end
	vng_merge_server()
	local nCheckLServer = GetGlbValue(GLB_TSK_SERVER_ID)
	if nCheckLServer < 150 or nCheckLServer > 158 then
		init_new_server()
		Init_Change_Server()
	end
	
	-- Set ID cho server Thµnh Long
	local nDateSpec = tonumber(date("%y%m%d"))
	if nDateSpec >= 111223 and nDateSpec <= 120123 then
		if gf_GetTaskByte(TSK_SERVER_ID, TSK_SERVER_ID_CUR) ~= 70 and GetGlbValue(GLB_TSK_SERVER_ID) == 70 then
			gf_SetTaskByte(TSK_SERVER_ID, TSK_SERVER_ID_CUR, 70)
		end
	end
	
	vng_playerlogin_init()
	
	local nDenBuDate = tonumber(date("%y%m%d"))
	if nDenBuDate >= 120814 and nDenBuDate <= 120814 then
		DenBu_BKL()
	end
	
--  Khu  v˘c trÂng b∏t nh∑ lÌn
	local nMapID = GetWorldPos()
	if (nMapID  == 301 or  nMapID == 108) and GetFightState() == 0 then
		SetFightState(1)
	end
	-- ¥¶¿Ì∞◊æ‘µ˜’˚£¨◊¢“‚∑≈‘⁄◊Ó∫Û£°
	if ExchangeComing == 0 then
		OfflineLiveEx()
	end
	if gf_GetTaskByte(TSK_SERVER_ID, TSK_SERVER_ID_CUR) == 49 then
		gf_SetTaskByte(TSK_SERVER_ID, TSK_SERVER_ID_CUR, 52)
	elseif  gf_GetTaskByte(TSK_SERVER_ID, TSK_SERVER_ID_CUR) == 45 then
		gf_SetTaskByte(TSK_SERVER_ID, TSK_SERVER_ID_CUR, 53)
	elseif  gf_GetTaskByte(TSK_SERVER_ID, TSK_SERVER_ID_CUR) == 54 then
		gf_SetTaskByte(TSK_SERVER_ID, TSK_SERVER_ID_CUR, 50)
	elseif gf_GetTaskByte(TSK_SERVER_ID, TSK_SERVER_ID_CUR) == 31 then
		gf_SetTaskByte(TSK_SERVER_ID, TSK_SERVER_ID_CUR, 43)
	elseif gf_GetTaskByte(TSK_SERVER_ID, TSK_SERVER_ID_CUR) == 18 then
		gf_SetTaskByte(TSK_SERVER_ID, TSK_SERVER_ID_CUR, 16)
	elseif gf_GetTaskByte(TSK_SERVER_ID, TSK_SERVER_ID_CUR) == 37 then
		gf_SetTaskByte(TSK_SERVER_ID, TSK_SERVER_ID_CUR, 26)
	end
	--==========================================201110‘¬∫£…œ¡˙÷€’Ω==============================
	if GetTask(2929) == 2 then
		dragon_boat_201110()
	end
	--==============================================
	
	local nDate = tonumber( date( "%y%m%d" ) )
	local nCurDate = floor ( GetTask( TSK_NEWRES_CALC_DAILY ) / 10 ) 
	if nCurDate ~= nDate then
		SetTask ( TSK_NEWRES_CALC_DAILY, nDate * 10 )
	end
	
	local nWeek = tonumber ( date ("%w") ) -- tr∂ v“ ngµy trong tu«n
	-- Chÿ reset task vµo th¯ 5 vµ th¯ 7
	if  nWeek == 4 or nWeek == 6 or nWeek == 0 then
		if mod(GetTask(TSK_NEWRES_CALC_DAILY), 10) == 0 then
			SetTask(TSK_TRANS_POINT_ALLOW,0)
			SetTask(TSK_NEWRES_CALC_DAILY,GetTask(TSK_NEWRES_CALC_DAILY) + 1)			
		end
	end
	-------------------------------------------------------------------------------------------------------------------------------------------
--	--Check ngµy h’t hπn Bπch Kim L÷nh BKL
--	local nBKL_End = GetTime()
--	local nCountBKL = CheckCharged_BKL() 
--	local nCountBKLbyTSK = GetTask(TSK_BKLB_COUNT)
--	local nActivebyTSK = GetTask(TSK_BKLB_ACTIVE)
--	--Msg2Player("G›a trﬁ byte 1: "..nCountBKL)
--	--Msg2Player("Gi∏ trﬁ nπp by task: ".. nCountBKLbyTSK)
--	--Msg2Player("Gi∏ trﬁ kich hoπt by task: ".. nActivebyTSK)
--
--	if CheckAccountExt_BKL() <= 0 then
--	--Msg2Player("ß∑ vµo 1")
--		if nCountBKLbyTSK > nCountBKL then
--			--Msg2Player("ß∑ vµo 2")
--			nCountBKL = nCountBKLbyTSK
--			local nTempExt = GetExtPoint(EXT_POINT_BKLB)
--			PayExtPoint(EXT_POINT_BKLB, nTempExt)
--			--SetByte(nTempExt,1, nCountBKL)
--			gf_SetExtPointByte(EXT_POINT_BKLB, BYTE_BKLB_COUNT, nCountBKL)
--			--local tam1 = gf_GetExtPointByte(EXT_POINT_BKLB, BYTE_BKLB_COUNT)  -- x„a
--			--Msg2Player("Gi∏ trﬁ byte 1 Ext sau: ".. tam1)			
--			--SetByte(nTempExt,2, nActivebyTSK)
--			gf_SetExtPointByte(EXT_POINT_BKLB, BYTE_BKLB_TYPE, nActivebyTSK)
--			--local tam2 = gf_GetExtPointByte(EXT_POINT_BKLB, BYTE_BKLB_TYPE) 			
--			--Msg2Player("Gi∏ trﬁ byte 2 Ext sau: ".. tam2)			
--			--AddExtPoint(EXT_POINT_BKLB, nTempExt)
--			--Msg2Player("Gi∏ trﬁ nπp Ext sau: ".. nTempExt)			
--			
--		end
--	end
--	if GetTask(TSK_BKLB_ACTIVE) > 0 then -- or nCountBKL >= 1 	--nCountBKLbyTSK == nCountBKL and 
--	--Msg2Player("ß∑ vµo 3")
--		if nCountBKL == nCountBKLbyTSK then
--		--Msg2Player("ß∑ vµo 4")
--			if nBKL_End - GetTask(TSK_BKLB_START) > 5270400 then --and CheckAccountExt_BKL() <= 0  chÿ c«n check ~ tr≠Íng hÓp Æ∑ nπp trong game
--			--Msg2Player("ß∑ vµo 5")
--				SetTask(TSK_BKLB_ACTIVE,0)
--				--local nTempExt1 = GetExtPoint(EXT_POINT_BKLB)
--				--PayExtPoint(EXT_POINT_BKLB, nTempExt1)
--				gf_SetExtPointByte(EXT_POINT_BKLB, BYTE_BKLB_TYPE, 0)
--				--SetByte(nTempExt1,2, 0)
--				--AddExtPoint(EXT_POINT_BKLB, nTempExt1)		
--				--gf_SetExtPointByte(EXT_POINT_BKLB, BYTE_BKLB_COUNT, nCountBKL)
--				Msg2Player("Bπch Kim L÷nh Æ∑ h’t hi÷u l˘c. Vui lﬂng k›ch hoπt lπi.")
--				Talk(1, "", "<color=green>ChÒ Phﬂng M∏y<color>: Bπch Kim L÷nh Æ∑ h’t hi÷u l˘c. Vui lﬂng k›ch hoπt lπi.")
--			end	
--		end
--	end
--	--------------- x„a trÔng task HKLB
--	if nDate >= 120323 and nDate <=120329 then
--		if GetTask(TSK_BKLB_HAVETASK) == 0 and GetTask(TSK_BKLB_START) >= 1332370895 and GetTask(TSK_BKLB_START) <= 1332457260 then
--			SetTask(2720, GetTask(2282))
--			SetTask(TSK_BKLB_HAVETASK, 1)
--		end
--	end
	--====================πÿø®»ŒŒÒµ»–¬‘ˆººƒ‹∂º‘⁄’‚¿Ô¥¶¿Ì…æ≥˝==============================
	--RemoveNewSkill()
	--=================≤∆…Ò±¶œ‰=====================================================
	treasure_box()
	--gtask÷ß≥÷NPC∂‘ª∞¥•∑¢∆˜ [∑¢œ÷¥•∑¢∆˜”–“Ï≥£]
	gtask_support()
	--πÿø®÷∏“˝»ŒŒÒ£®–≈º˛£©
	get_message_task()
	--∏¯”Ë∞Àÿ‘±¶µ‰
	--give_baguabaodian();
	VietResetDate() -- reset task mÁi ngµy
	--ÃÙ’Ω¡∫…ΩbossªÓ∂Ø
	LSB_Challenge_Trigger();
	--∞¬‘ÀªÓ∂Ø
	oly_create_trigger();
	--«ß—∞À˛¥•∑¢∆˜¥¥Ω®
	qht_create_trigger();
	--◊∑ªÿ◊÷Ã˚¥Û◊˜’Ω
	dzt_tmz_trigger();
-- Nhi÷m vÙ Æ∏nh qu∏i chuy”n sinh 6
	if GetTask(TSK_CS6_TULINH) == 4 then
		CreateTrigger(0,1279,2558)
	end
	if GetByte(GetTask(TRANSLIFE_TASK_ID), TRANSLIFE_BYTE_FLAG_LEVEL) == 1 then
		local nLevel_CS6 = GetByte(GetTask(TRANSLIFE_TASK_ID), TRANSLIFE_BYTE_SAVE_LEVEL)
		SetLevel(nLevel_CS6,0)
		gf_SetTaskByte(TRANSLIFE_TASK_ID, TRANSLIFE_BYTE_FLAG_LEVEL, 0)	
	end
	---------	
	--VÀn may Æπo h˜u
--	if nDate > 130423 and nDate <= 131230 then
		vanmay_daohuu()		--t›nh n®ng Æang Æ„ng (set Æi”m v“ 100, khi mÎ lπi ph∂i mÎ giÌi hπn ngµy th∏ng)
--	end	
--	if nDate <= 130423 then --Æ“n bÔ ngµy 22/4/2013
--		vanmay_daohuu_denbu()
--	end	
	--…œœﬂ¡Ï»°«∑±‚∫–Ã· æ
	show_yunling_box_login_message()
	--’Ê∆¯’Ω≥°
	ZQ_Leave_Game();
	--∞Ôª· ¢—ÁµƒBUFF
	tf_PlayerLoginAddBuff();
	--NpcÀ¿Õˆ¥•∑¢∆˜
	--\script\global\npcdeath_trigger.lua
	if GetTrigger(1297*2) <= 0 then
		CreateTrigger(0, 1297, 1297*2);
	end
	--¥∫Ω⁄ªÓ∂Ø
	sp_CreateTalkTrigger();
	--ªÓ∂Øµ¿æﬂÃÌº”
	wxfls_AddItemPlayerlogin();
	
	onlogin_fix_meridian_attr_point_addon()--◊‘∂Ø–ﬁ∏¥æ≠¬ˆ¥¯¿¥µƒ«±ƒ‹µ„…œœﬁ¿©’π
	
	Observer:onEvent(SYSEVENT_PLAYER_LOGIN, ExchangeComing)
	--µ«¬ººÏ≤ÈŒ‰¡÷π¶—´∞Ê±æ «∑Ò–Ë“™∏¸–¬
	merit_PlayerLogin();
	--Àƒ¡È ‘¡∂∏±±æ
	slt_LeaveGame();
	ibc_PlayerLogin(); --∫⁄µ¿æﬂ≤π≥•ªÓ∂Ø
	
	-------------------------------------------------------
end;
--*****************************…æ≥˝π˝∆⁄ŒÔ∆∑*************************
overdue_goods_list = {
	--◊∞±∏¥Û¿‡-∏±¿‡------------------------–°¿‡¡–±Ì---------------------”––ß∆⁄£®ÃÏ£©--…æ≥˝ŒÔ∆∑Ã· æ
	{0,		109,173,174,175,176,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,1,"Y phÙc h´n l‘ bπn thu™ Æ∑ h’t hπn!"},	--Ω·ªÈ“¬∑˛
	{0,		108,131,132,133,134,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,1,"Trang s¯c h´n l‘ bπn thu™ Æ∑ h’t hπn!"},	--Ω·ªÈÕ∑ Œ
	{0,		109,177,178,179,180,1,"ChÒ h´n l‘ bπn thu™ Æ∑ h’t hπn!"},
	{0,		105,32,1,"Ki÷u hoa h´n l‘ bπn thu™ Æ∑ h’t hπn!"},
	-- Ph«n nµy kh´ng Merg khi c„ event mÌi
	--{0,		105,33,1,"Ni™n thÛ cÒa bπn Æ∑ h’t hπn!"},
}
function Del_overdue_goods()
	local time_now = GetTime()
	local obj_index, item_index = GetFirstItem();
	local nDeletedCount = 0;
	while (obj_index ~= 0 and item_index ~= 0) do
		local genre = GetItemGenre(item_index)
		local detail = GetItemDetail(item_index)
		local particular = GetItemParticular(item_index)
		for i = 1, getn(overdue_goods_list) do
			local nSize = getn(overdue_goods_list[i]);
			if genre == overdue_goods_list[i][1] and detail == overdue_goods_list[i][2] then
				for j = 3,nSize-2 do
					if particular == overdue_goods_list[i][j] and time_now - GetItemCreateTime(item_index) >= (86400 * overdue_goods_list[i][nSize-1]) then
						DelItemByIndex(item_index,-1)
						Msg2Player(overdue_goods_list[i][nSize])
						nDeletedCount = nDeletedCount + 1;
					end
				end
			end
		end
		obj_index, item_index = GetNextItem(obj_index, item_index)
	end
	if nDeletedCount ~= 0 then
		Say("Bπn c„ "..nDeletedCount.."vÀt ph»m Æ∑ h’t hπn, chi ti’t xem h÷ thËng th´ng b∏o!",0);
	end;
end

function add_pouch_new_year_09_viet(tItem, szLog)
	local szItemName = tItem[1]
	local G, D, P = tItem[2], tItem[3], tItem[4]
	local nItemNum = tItem[5]
	local nRetCode = 0

	nRetCode = AddItem(G, D, P, nItemNum)
	if nRetCode == 1 then
		Msg2Player("Bπn nhÀn Æ≠Óc  "..nItemNum.." c∏i "..szItemName)
		WriteLogEx(szLog, "NhÀn Æ≠Óc", nItemNum, szItemName, format("(%d,%d,%d)", G, D, P), GetTongName() )
	else
		WriteLogEx(szLog, "NhÀn Æ≠Óc", nItemNum, szItemName, format("(%d,%d,%d)", G, D, P), GetTongName(), "Thu Æ≠Óc th t bπi, ".."AddItem return value = "..nRetCode)
	end
end

function remove_oldquest()
	SetTask(101, 874)
	if GetTrigger(51) ~= 0 then
		RemoveTrigger(GetTrigger(51))
	end
	if GetTrigger(52) ~= 0 then
		RemoveTrigger(GetTrigger(52))
	end
	if GetTrigger(53) ~= 0 then
		RemoveTrigger(GetTrigger(53))
	end
	if GetTrigger(61) ~= 0 then
		RemoveTrigger(GetTrigger(51))
	end
	if GetTrigger(71) ~= 0 then
		RemoveTrigger(GetTrigger(51))
	end
	if GetTrigger(72) ~= 0 then
		RemoveTrigger(GetTrigger(51))
	end
end

-- œ¬ΩŒ
function UnSedan()
	local genre, detail, particular = GetPlayerEquipInfo(10)
	if (genre == 0 and detail == 105 and particular == 32) then
		DesaltPlayer(1, 7)
	end
end

function OnDoll()
	if (GetTask(TASKVAR_DOLLTIME) ~= 0) then
		if (GetMateOnlineStatus() == 1) then
			KillFollower()
			ActivateDoll(0)
		else
			local follower = GetFollower()
			if follower > 0 then
				SetCurrentNpcSFX(follower, SFX_DOLL, 1, 1)
			end;
			ActivateDoll(1)
		end
	end
end

function ShowShinyNightMsg()
	local system = GetGlbValue(GAMESVRGLB_SYSTEM)
	local multiple = GetGlbValue(GAMESVRGLB_MULTIPLE)
	if (system ~= 0) then
		Msg2Player(format("ª‘ªÕ÷Æ“πªÓ∂ØΩ¯––÷–£¨Ω±¿¯∑≠±∂µƒœµÕ≥ «%s£¨±∂¬  «%1.1f",
			map_sysnames[system],
			multiple / 100))
	end
end

--=================================¥Â≥§µƒµ«¬Ω÷¥––∫Ø ˝=============================
function Zgc_login_fun_main()
	player_out_huashan()
	nw_mission_out()
	tomb_sweep_2008()
	ma_same_heart_deal()			--Õ¨–ƒ÷µ◊‘∂Ø¥¶¿Ì
	task_talk_deal()				--»ŒŒÒÃ· æ¥¶¿Ì
end

--*********************************ª™…Ωæ∫ºº******************************
function player_out_huashan()
	--π¶ƒ‹£∫Ω´‘⁄ª™…Ω«¯œ¬œﬂ∫Û…œœﬂµƒÕÊº“«Â¿Ì≥ˆª™…ΩµÿÕº°£
	local map_id = GetWorldPos()
	if map_id == 969 then
		NewWorld(100,1420,2989)
	end
end


--Œ˜±±πÿø®¥´≥ˆ¥¶¿Ì
function nw_mission_out()
	local mapid = GetWorldPos()
	for i= 1, 6 do
		for j	= 1,2 do
			for k = 1,getn(Stage_info[i].map[j]) do
				if Stage_info[i].map[j][k] == mapid then
					Ms_on_log_in()
					break
				end
			end
		end
	end
end

function north_west_mission_out()
	local mission_diff = GetTask(Task_ID_stage_diff)
	if mission_diff == 2 then
		SetPKFlag(1,1)		--PK◊¥Ã¨
		ForbidChangePK(0)	--Ω˚÷π◊™ªªPK◊¥Ã¨
	end
	UseScrollEnable(1)	--ø…“‘ π”√ªÿ≥«∑˚
	ForbitTrade(0)		--ø…“‘Ωª“◊
	StallEnable(1)		--ø…“‘∞⁄ÃØ
	SetDeathPunish(1)	--”–À¿Õˆ≥Õ∑£
	OpenFriendliness(1)	--‘ˆº”∫√∏–∂»
	RestoreAll()		--»´≤øªÿ∏¥
end
--*******************************2008«Â√˜Ω⁄ªÓ∂Ø**************************
function tomb_sweep_2008()
	--¥•∑¢∆˜…æ≥˝
	local task_diff = GetTask(1854)
	local nDate = tonumber(date("%Y%m%d"));
	if nDate <= 20080412 then
		return
	end
	if task_diff ~= 1 and task_diff ~= 3 and task_diff ~= 8 and task_diff ~= 10 then
		return
	end
	for i = 900,903 do
		local trigger_ID = GetTrigger(i)
		if trigger_ID ~= 0  then
			RemoveTrigger(GetTrigger(trigger_ID))
		end
	end
end
--******************************Õ¨–ƒ÷µÀ•ºı¥¶¿Ì***************************
TaskID_attenuation_date_seq = 1219
TaskID_same_heart_value = 2015
Same_heart_value_max_TaskID = 2023		--Õ¨–ƒ÷µ…œœﬁid
function ma_same_heart_deal()
	---------------------------Õ¨–ƒ÷µ…œœﬁ¥¶¿Ì---------------------------
	if GetTask(Same_heart_value_max_TaskID) <= 500 then
		SetTask(Same_heart_value_max_TaskID,500)
	end
	---------------------------Õ¨–ƒ÷µÀ•ºı¥¶¿Ì---------------------------
	local day_seq_dealed = GetTask(TaskID_attenuation_date_seq)
	local day_seq_now = zgc_pub_day_turn(1)
	--µ⁄“ª¥Œ≤ª¥¶¿Ì
	if day_seq_dealed == nil or day_seq_dealed == 0 then
		SetTask(TaskID_attenuation_date_seq,day_seq_now)
		return
	end
	--º∆À„≤Ó“ÏÃÏ ˝
	local day_distance = day_seq_now - day_seq_dealed
	if day_distance < 7 then
		return
	end
	--Õ¨–ƒ÷µÀ•ºı
	local same_heart_value = GetTask(2015)
	local attenuation_num = 0
	if same_heart_value <= 500 then
		attenuation_num = (day_distance * 4)
	elseif same_heart_value >501 and same_heart_value <= 2000 then
		attenuation_num = floor(same_heart_value * (0.06/7) * day_distance)
	else
		attenuation_num = floor(same_heart_value * (0.12/7) * day_distance)
	end
	--º«»Îµ±«∞ÃÏ–Ú ˝
	SetTask(TaskID_attenuation_date_seq,day_seq_now)
	--»Áπ˚À•ºı÷µ¥Û”⁄µ±«∞÷µ‘Ú…Ë÷√Œ™0
	if same_heart_value <= attenuation_num then
		SetTask(TaskID_same_heart_value,0)
	else
		SetTask(TaskID_same_heart_value,(same_heart_value - attenuation_num))
	end
end
--¡∫…Ωπÿø®∫ÕÃÏ√≈’Û…œœﬂÃ· æ
nTaskId_LS_TMS_TALK = 2856
tLsTmz_TALK_INFO = {
	{70,"Thi™n M´n TrÀn: Nhªm t®ng quy m´ tham gia chi’n tr≠Íng Di‘n V‚ Thi™n M´n TrÀn, qu©n s‹ ßπi TËng Æ∑ mÎ th™m chi’n trÀn di‘n v‚ Thi™n M´n TrÀn tπi Thµnh ß´ (231, 229) vµ ßπi L˝ (179,179) h∑y Æ’n Æ„ t◊m Qu∏ch Qu©n Bªng b∏o danh tham gia"},
	{80,"Khi™u chi’n L≠¨ng S¨n: L≠¨ng S¨n 108 vﬁ t≠Ìng gˆi lÍi mÍi Æ’n c∏c vﬁ hµo ki÷t tr™n giang hÂ Æ’n t˚ v‚ giao h˜u, Æπi hi÷p c„ th” Æ’n c∏c thµnh chÒ t◊m Thµnh Hµnh Th∏i B∂o ßÌi T´ng (b™n cπnh Th«n Du Ch©n Nh©n) Æ” Æ≠Óc tham gia v≠Ót ∂i"},
}
function task_talk_deal()
	local nPlayerLevel = GetLevel()
	local nTalkValue = GetTask(nTaskId_LS_TMS_TALK)
	for i = 1,getn(tLsTmz_TALK_INFO) do
		if nPlayerLevel >= tLsTmz_TALK_INFO[i][1] and GetBit(nTalkValue,i) == 0 then
			LsTmz_login_talk(i)
			break
		end
	end
end
function LsTmz_login_talk(nTalkSeq)
	Talk(1,"#LsTmzTalkFinish("..nTalkSeq..")",tLsTmz_TALK_INFO[nTalkSeq][2])
end
function LsTmzTalkFinish(nTalkSeq)
	local nTalkValue = GetTask(nTaskId_LS_TMS_TALK)
	nTalkValue = SetBit(nTalkValue,nTalkSeq,1)
	SetTask(nTaskId_LS_TMS_TALK,nTalkValue)
end
--==================================Ω· ¯=================================

--========================07∆ﬂœ¶ªÓ∂Ø======================================
--Õ≥º∆‘⁄œﬂ ±º‰£¨≤¢‘ˆº”≥…≥§∂»
function flower_time()
	--√ª÷÷ª®≤ªÕ≥º∆
	if GetTask(TASK_IS_PLANT) == 0 then
		return
	end
	--≥…≥§∂»µΩ100≤ª‘ŸÕ≥º∆
	if GetTask(TASK_FLOWER_GROW) >= 100 then
		return
	end
	--µ±ÃÏ≥…≥§∂»“—æ≠º”1£¨≤ª‘ŸÕ≥º∆
	local now_days = floor((GetTime()+28800)/86400);
	if now_days == GetTask(TASK_IS_GROW) then
		return
	end

	if GetTask(TASK_LAST_LOGIN) ~= GetLastLoginTime()+28800 then   --≈–∂œ «∑ÒøÁ∑˛
		SetTask(TASK_CURRENT_LOGIN,GetTime()+28800);  --º«¬ºµ±«∞µ«¬Ω ±º‰
		SetTask(TASK_LAST_LOGIN,GetLastLoginTime()+28800);
	else                     --øÁ∑˛“≤≤ªÕ≥º∆
		return
	end

	local nThisTime = floor(GetTask(TASK_CURRENT_LOGIN)/86400);
	local nLastTime = floor((GetLastLoginTime()+28800)/86400);
	if nLastTime ~= 0 and nThisTime ~= nLastTime then
		SetTask(TASK_TOTAL_TIME,0);
	end
end
--==========================================================================================
function process_biwudahui()
	StopTimeGuage(-1);
	local nVersion,nCurGs = GetRealmType();
	if nCurGs == 1 then
		SetFightState(0);
--		if GetSvrConfig("IsSaveRoleData") == 0 then
--			Del_Item_By_List();
--			Add_Item_By_List(g_tGiveItemList);
--			Del_Spe_Item();
--			--“¯»Ø¥¶¿Ì£∫øÁ∑˛«¯œ»∏…µÙ“¯»Ø
--			local nValue = GetYinQuan();
--			ModifyYinQuan(-nValue);
--			Msg2Player("“¯»Ø ˝¡ø‘⁄∑µªÿ‘≠∑˛∫Ûª÷∏¥£°");
--		end
		ForbidChangePK(1);
		ForbitTrade(1);	--Ω˚÷πΩª“◊
		StallEnable(0);	--Ω˚÷π∞⁄ÃØ
		local nMap_ID = GetWorldPos();
		local tDLGC_Map = {};
		if _JX2WZ ~= 2 then
			tDLGC_Map = {
				[7990] = 1,
				[7991] = 1,
				[7992] = 1,
				[7993] = 1,
				[7994] = 1,
			};
		else
			tDLGC_Map = {
				[7990] = 1,
				[7991] = 1,
				[7992] = 1,
			};
		end
		if nMap_ID == 7100 then --±»Œ‰¥Ûª·
			SetTask(TSK_JOIN_LIST_TYPE,-1,TASK_ACCESS_CODE_BIWUDAHUI);
			JoinGestConvention();
			RemoveRevivals();	--«Â≥˝ŒÂ∂æ±¶±¶
			SetTask(TSK_JOIN_LIST,1,TASK_ACCESS_CODE_BIWUDAHUI);
			Add_Item_By_List(g_tGiveItemList_biwu)
		elseif nMap_ID == 7980 then --øÁ∑˛ÃÏ√≈’Û
			Add_Item_By_List(g_tGiveItemList_tmz_dlgc)
		elseif nMap_ID == 8000 then	-- NVN
--			NvnHall_Enter();
--			SendScript2Client(format("Open('nvnHall', %d)",1));
--			NVN_UpdateItemEnhance();
			Add_Item_By_List(g_tGiveItemList_biwu)
			P3v3_Join();
			SendScript2Client("Open('3v3')");
--		elseif tDLGC_Map[nMap_ID] == 1 then --¥Ô¬≥π≈≥«±®√˚¥¶
--			Add_Item_By_List(g_tGiveItemList_tmz_dlgc)
--			DLGC_Join();
--			SendScript2VM("\\script\\missions\\dlgc\\dlgc_sign_up.lua", "onPlayerLogin()");
--			--SendScript2Client("Open('DLGCBattle')");
--			WriteLog(format("[date:%s][role:%s][acc:%s][¥Ô¬≥π≈≥«µ«¬º±®√˚≥°µÿ][GSID:%d]",date("%Y%m%d%H%M%S"),GetName(),GetAccount(), GetGSIndex()[0]));
--		elseif nMap_ID == 7102 then
--			SetTask(TASKID_XSBK_ENTER_TIME, GetTime());
--			local nMinute = tonumber(date("%M"));
--			local nSecond = tonumber(date("%S"));
--			local nDeltaTime = (40 - nMinute) * 60 + nSecond;
--			if nDeltaTime > 0 then
--				StartTimeGuage("Œ˜…Ω±¶ø‚µπº∆ ±", nDeltaTime, 0, 1);
--			end
--			local szMsg = " ß¬‰—¬µƒŒ˜…Ω±¶ø‚ªÓ∂ØΩ´”⁄" .. date("%H") .. "µ„40∑÷’˝ Ωø™ º£¨œ¿øÕ«Î‘⁄¥Àµ»¥˝«¯”ÚƒÕ–ƒµ»∫Ú°£";
--			Talk(1, "", szMsg);
--			Msg2Player(szMsg);
		end
		--Õ‚◊∞‘Ã¡È£∫øÁ∑˛«¯≤ª∏¯«ß±‰∫–
--		local nQBHCount = BigGetItemCount(2,95,572);
--		if nQBHCount > 0 then
--			BigDelItem(2,95,572,nQBHCount);
--		end
		--ººƒ‹ ØΩıƒ“
--		local nJNSCount = BigGetItemCount(2,1,10010);
--		if nJNSCount > 0 then
--			BigDelItem(2,1,10010,nJNSCount);
--		end
	else
		--«ß±‰∫–
--		local nQBHCount = BigGetItemCount(2,95,572);
--		if nQBHCount < 1 then
--			AddItem(2,95,572,1);
--		end
		--ººƒ‹ ØΩıƒ“
--		if 0 >= BigGetItemCount(2,1,10010) then
--		AddItem(2,1,10010,1,4);
--		end
	
		SendScript2Client(format("Open('nvnHall', %d)",0));
		SendScript2Client(format("Open('nvnRoom', %d)",0));
		local nNowDate = tonumber(date("%Y%m%d%H"));
		if nNowDate < g_nBWAwardDate then
			Msg2Player("Ph∏t th≠Îng ßπi HÈi T˚ V‚ li™n Æ u, tı 10 giÍ 12/05/2014 Æ’n 22 giÍ 18/05/2014 c„ th” Æ’n Æ∆c s¯ ßπi HÈi T˚ V‚ nhÀn th≠Îng.");
		end
--		if GetTask(TASKID_BIWU_IS_REALM) ~= 0 then
--			GLB_BW_SynData(0,0);--Õ¨≤Ω ˝æ›
--			local nRoute = GetPlayerRoute();
--			if nRoute == 21 then
--				GLB_BW_SynData(0,1);
--			end
--			GLB_BW_SynData(0,2);
--			GLB_BW_SynData(0,3);
--		else
			process_biwudahui_update_zige()
			process_biwudahui_2()
--		end
	end
end;

function process_biwudahui_2()
	--SetTask(TASKID_BIWU_IS_REALM,0);
	g_tZiGePoint = {};
	local nCurPoint = GetTask(666);
	local nSignUpInfo = GetTask(678);
	local nBeginTime = MkTime(2014,5,12,10,0,0);
	local nCurTime = GetTime();
	local nWeek = ceil((nCurTime-nBeginTime)/(7*24*3600));
	local nCurSeason = ceil(nWeek/g_nBWWeeks); --µ⁄º∏»¸ºæ
	local nSeasonWeek = mod(nWeek,g_nBWWeeks); --µ±«∞»¸ºæµƒµ⁄º∏÷‹
	if nSeasonWeek == 0 then
		nSeasonWeek = g_nBWWeeks;
	end
	local nCurWeek = tonumber(date("%w"));
	nBeginTime = nBeginTime+(nCurSeason-1)*g_nBWWeeks*7*24*3600;

	if nCurTime >= nBeginTime and GetTask(649) ~= nBeginTime then
		if BWDH_DEBUG_VERSION == 1 then
			print("biwudahui new season:", GetName(), nCurTime, GetTask(649));
		end
		SetTask(647,nSignUpInfo, TASK_ACCESS_CODE_BIWUDAHUI);	--º«¬º∫œ≤¢«∞µƒ±®√˚«Èøˆ
		if nSignUpInfo ~= 0 then	--±®π˝√˚µƒÕÊº“
			if nSignUpInfo == 1 then	--»Áπ˚ «–¬–„±»Œ‰¥Ûª·—° ÷
				SetTask(678,2);
			end;
			if nCurPoint < 200 then	--÷ª∏¯200∑÷“‘œ¬µƒÕÊº“‘ˆº”ª˝∑÷
				if nCurPoint + 100 > 200 then
					SetTask(666,200,TASK_ACCESS_CODE_BIWUDAHUI);
					Msg2Player("ßi”m t˚ v‚ Æ∑ t®ng"..(200 - nCurPoint).." PhÛt ");
				else
					SetTask(666,nCurPoint+100,TASK_ACCESS_CODE_BIWUDAHUI);
					Msg2Player("ßi”m t˚ v‚ Æ∑ t®ng 100 Æi”m");
				end;
			end;
			SetTask(646,GetTask(662),TASK_ACCESS_CODE_BIWUDAHUI);	--º«¬º∫œ≤¢«∞µƒ◊ ∏Òª˝∑÷
			SetTask(TSK_SEASON_ZIGE_LAST,GetTask(662),TASK_ACCESS_CODE_BIWUDAHUI); --º«¬º…œ»¸ºæµƒ◊ ∏Òª˝∑÷
			SetTask(662,0,TASK_ACCESS_CODE_BIWUDAHUI);	--◊ ∏Òª˝∑÷«Â0
			Msg2Player("ßi”m t≠ c∏ch Æ∑ x„a 0");
			local nLevel = GetLevel();
			local nRoute = GetPlayerRoute();
			if not bInit then
				ApplyRelayShareData("GestConvention_Zige_Last", nLevel, nRoute, g_szThisFile, "gc_zige_point_callback");
			else
				local nPlayerName = GetName();
				if GetTask(TSK_SEASON_ZIGE_LAST) < g_tZiGePoint[nPlayerName] then
					SetTask(TSK_SEASON_ZIGE_LAST,g_tZiGePoint[nPlayerName],TASK_ACCESS_CODE_BIWUDAHUI);
				end
			end
		end;
		SetTask(649,nBeginTime,TASK_ACCESS_CODE_BIWUDAHUI);
	end;

	--∂‘”⁄¥Û”⁄µ±«∞÷‹◊Ó∏ﬂ◊ ∏Ò∑÷µƒΩ¯––¥¶¿Ì
	if nCurWeek ~= 0 and nCurWeek ~= 1 then --–«∆⁄ÃÏ∫Õ–«∆⁄“ª∂º≤ªΩ¯––¥¶¿Ì
		local nMaxPoint = (nSeasonWeek-1)*100;
		if GetTask(662) > nMaxPoint then
			SetTask(662,nMaxPoint,TASK_ACCESS_CODE_BIWUDAHUI);
			SignUpGestResult();	--Ω´ª˝∑÷«ø÷∆µ«º«…œ»•
			Msg2Player("Do t≠ c∏ch tham d˘ ßπi HÈi T˚ V‚ cÒa bπn kh´ng hÓp l÷, nay Æ∑ sˆa vµ Æ®ng k˝ lπi.");
		end
	end

	if GetTask(673) == 1 then	--»Áπ˚±®√˚≤Œº”¡ÀΩœ“’
		JoinGestConvention();
	end;
	nCurPoint = GetTask(666);
	if GetTask(674) ~= 0 then	--—°‘Òπ˝≥Ã÷–œ¬œﬂ¡À£¨…œœﬂ ±µ±æ‹æ¯±»Œ‰¥¶¿Ì
		SetTask(666,nCurPoint-2,TASK_ACCESS_CODE_BIWUDAHUI);
		Say("Tı chËi t˚ v‚, trı 2 Æi”m so tµi",0);
		SetTask(674,0,TASK_ACCESS_CODE_BIWUDAHUI);
		Msg2Player("Tı chËi t˚ v‚, trı 2 Æi”m so tµi");
	end;
	
	SendScript2VM("\\script\\biwudahui\\tournament\\tournament_function.lua", "BWT_WeeklyClear()")
	--==œ¬√Êµƒ¥˙¬Î“™∫ÕBWT_WeeklyClearµƒπ¶ƒ‹“ª—˘
--	local nWeekNum = GetPlayerBwRank();
--	local nBodyWeek = GetTask(680);
--	if nWeekNum == -1 then	--Relayπ“¡À
--		return 0;
--	end;
--	if nBodyWeek - nWeekNum >= 1 then	--∫œ∑˛∫ÛnWeekNumª·¥”0ø™ º
--		SetTask(680,nWeekNum-1,TASK_ACCESS_CODE_BIWUDAHUI);	--Õ¨≤ΩÕÊº“…Ì…œµƒ÷‹ ˝
--		SetTask(676,nWeekNum-1,TASK_ACCESS_CODE_BIWUDAHUI);	--Õ¨≤ΩÕÊº“¡Ï»°Ω±¿¯µƒ÷‹ ˝
--		nBodyWeek = nWeekNum-1;
--	end;
--	
--	if BWDH_DEBUG_VERSION == 1 then
--		print("biwudahui weekly check:", GetName(), nBodyWeek, nWeekNum);
--	end
--	if nBodyWeek < nWeekNum then
--		process_bw_point_attenuation();
--		SetTask(667,0,TASK_ACCESS_CODE_BIWUDAHUI);	--±æ÷‹◊‹≤Œ”Î≥°¥Œ
--		SetTask(668,0,TASK_ACCESS_CODE_BIWUDAHUI);		--±æ÷‹ §¿˚≥°¥Œ
--		SetTask(669,0,TASK_ACCESS_CODE_BIWUDAHUI);		--±æ÷‹ ß∞‹≥°¥Œ
--		SetTask(679,0,TASK_ACCESS_CODE_BIWUDAHUI);	--±æ÷‹Õ®π˝Ωœ“’ªÒµ√µƒ–ƒµ√ ˝¡ø
--		SetTask(665,0,TASK_ACCESS_CODE_BIWUDAHUI);	--µ«º«ª˝∑÷«Â0
--		SetTask(681,0,TASK_ACCESS_CODE_BIWUDAHUI);	--±æ÷‹ªÒµ√ µ’Ω–ƒµ√«Èøˆ«Â0
--		SetTask(682,0,TASK_ACCESS_CODE_BIWUDAHUI);		--±æ÷‹ π”√ µ’Ω–ƒµ√«Â£∞
--		SetTask(683,0,TASK_ACCESS_CODE_BIWUDAHUI);		--±æ÷‹¬Ú¬Ì«Â£∞
--		SetTask(685,0,TASK_ACCESS_CODE_BIWUDAHUI);	-- π”√¥´π¶–ƒµ√
--		SetTask(640,0,TASK_ACCESS_CODE_BIWUDAHUI);	--±æ÷‹∂“ªªµƒ’Ω≥°Ω±¿¯¥Œ ˝
--		SetTask(687,0,TASK_ACCESS_CODE_BIWUDAHUI);		--±æ÷‹∂“ªªµƒ ¶√≈Ω±¿¯¥Œ ˝
--		SetTask(642,0,TASK_ACCESS_CODE_BIWUDAHUI);		--±æ÷‹∂“ªªµƒ¡È ØΩ±¿¯¥Œ ˝
--		SetTask(643,0,TASK_ACCESS_CODE_BIWUDAHUI);		--±æ÷‹∂“ªªµƒæ≠—ÈΩ±¿¯¥Œ ˝
--		
--		SetTask(3219,0,TASK_ACCESS_CODE_BIWUDAHUI);		--«∞10≥°µƒ §¿˚≥°¥Œ
--		SetTask(3220,0,TASK_ACCESS_CODE_BIWUDAHUI);		--«∞10≥°µƒ ß∞‹≥°¥Œ
--		SetTask(3221,0,TASK_ACCESS_CODE_BIWUDAHUI);		-- «∑Ò¡Ï»°¡À«∞10≥°µƒΩ±¿¯
--		
----		SetTask(2732,0);
----		SetTask(2733,0);
----		SetTask(2734,0);
--		if GetTask(666) < 200 then
--			SetTask(666,200,TASK_ACCESS_CODE_BIWUDAHUI);	--µÕ”⁄100∑÷µƒªÿπÈµΩ100∑÷
--		end;
--	end
	if GetTask(667) >= 10 then
		SetTask(665,GetTask(666),TASK_ACCESS_CODE_BIWUDAHUI);
		SignUpGestResult();	--Ω´ª˝∑÷µ«º«…œ»•
	end
end

--∏¸–¬µ±«∞»¸ºæ◊ ∏Ò∑÷
g_tZiGePointChange = {}
g_tZiGePointChangeInit = {}
function process_biwudahui_update_zige()
	local nLevel = 1 --GetLevel()
	local nRoute = GetPlayerRoute()
	if not g_tZiGePointChangeInit[nRoute] then
		ApplyRelayShareData("GestConvention_Change", nLevel, nRoute, g_szThisFile, "process_biwudahui_update_zige_cb")
	else
		process_biwudahui_update_zige_do_update()
	end
end

function process_biwudahui_update_zige_cb(szKey,nLevel,nRoute,nRecordCount)
	g_tZiGePointChangeInit[nRoute] = 1
	if nRecordCount == 0 then
		return 0
	end
	for i=1,nRecordCount do
		--∑µªÿ÷µ£∫ÕÊº“√˚£¨◊ ∏Òª˝∑÷
		szName,nPoint = GetRelayShareDataByIndex(szKey,nLevel,nRoute,i-1)
		g_tZiGePointChange[szName] = nPoint;
	end
	process_biwudahui_update_zige_do_update()
end

function process_biwudahui_update_zige_do_update()
	local nPlayerName = GetName()
	local nNewPoint = g_tZiGePointChange[nPlayerName] or 0
	if nNewPoint > 0 then
		local szScript = format("SyncZgPoint(%d)", nNewPoint)
		SendScript2VM("\\script\\global\\gest_convention_callback.lua", szScript)
	end
end


function GLB_BW_Return_Tb(...)
	local nReturnTb = {};
	for i=1,arg.n do
		tinsert(nReturnTb,arg[i]);
	end
	return nReturnTb
end

--øÁ∑˛±»Œ‰Õ¨≤Ω ˝æ›
function GLB_BW_SynData(nkey1,nkey2)
	local strName = GetName();
	strName = "Realm_"..strName;
	ApplyRelayShareData(strName,nkey1,nkey2,g_szThisFile,"GLB_BW_Syn_CB");
end

function GLB_BW_Syn_CB(strName,nkey1,nkey2)
	local TbList = {};
	local strItemKey,strPrefix = "","";
	local tGushiTask = {--π∆ ¶µƒ±‰¡ø
		2204,2216,2207,2222,2219,2210,2228,2213,2225,2231
	};

	if nkey1 == 0 and nkey2 == 1 then --π∆ ¶
		--2012-08-01 æˆ∂®≤ª‘ŸÕ¨≤Ωπ∆ ¶
--		TbList = GLB_BW_Return_Tb(GetRelayShareDataByKey(strName,nkey1,nkey2,"GS"));
--		if getn(TbList) < 2 then
--			return 0;
--		end
--		for i = 1,getn(TbList) do
--			if tGushiTask[i] ~= nil or tGushiTask[i] ~= 0 then
--				SetTask(tGushiTask[i],TbList[i]);
--			end
--		end
	elseif nkey1 == 0 and nkey2 == 2 then --Â–“£±“
		local nValue = GetRelayShareDataByKey(strName,nkey1,nkey2,"XYB");
		if nValue == nil or nValue < 0 then
			return 0;
		end
		PayXYB(nValue);
		SetTask(TASKID_XOYO_CONSUME,0);
		WriteLog(format("[Xu Ti™u Dao] [Role:%s Acc:%s] [TËn Xu Ti™u Dao  %d]", GetName(), GetAccount(), nValue));
	elseif nkey1 == 0 and nkey2 == 3 then --Â–“£”Ò
		local nValue = GetRelayShareDataByKey(strName,nkey1,nkey2,"XYY");
		if nValue == nil or nValue < 0 then
			return 0;
		end
		PayXYY(nValue);
		SetTask(TASKID_XOYOYU_CONSUME,0);
		WriteLog(format("[Ti™u Dao Ng‰c] [Role:%s Acc:%s] [TËn Ti™u Dao Ng‰c  %d]", GetName(), GetAccount(), nValue));
	else
		if nkey1 == 0 then 			--±»Œ‰¥Ûª·
			strPrefix = "BW";
		elseif nkey1 == 1 then 		--ÃÏ√≈’Û
			strPrefix = "TMZ";
		elseif nkey1 == 2 then		--¥Ô¬≥π≈≥«
			strPrefix = "DLGC";
		end
		for i = 1,500 do
			strItemKey = strPrefix..tostring(i);
			TbList = GLB_BW_Return_Tb(GetRelayShareDataByKey(strName,nkey1,nkey2,strItemKey));
			if getn(TbList) < 2 then
				break;
			end
			for i=1,getn(TbList),2 do
				if TbList[i] ~= 0 and TbList[i+1] ~= nil then
					SetTask(TbList[i],TbList[i+1]);
				end
			end
		end
		process_biwudahui_2();
	end
	DelRelayShareDataCopy(strName,nkey1,nkey2)
	ClearRelayShareData(strName,nkey1,nkey2,g_szThisFile,"GLB_BW_Clear_callback")

	--≥…æÕ----------------------------
	local nWinNum = GetTask(TASKID_ACH_BIWU_WIN_TOTAL);
	if nWinNum > 0 then
		SetTask(3712,nWinNum);
		OnAchEvent(2,3712);
	end
	local nUseNewRoute = GetTask(TASKID_ACH_USE_NEW_ROUTE);
	local nWinNewRoute = GetTask(TASKID_ACH_WIN_NEW_ROUTE);
	if nUseNewRoute > 0 then
		SetTask(3738,nUseNewRoute);
		OnAchEvent(2,3738);
	end
	if nWinNewRoute > 0 then
		SetTask(3739,nWinNewRoute);
		OnAchEvent(2,3739);
	end
	--≥…æÕ¿Ô√ÊµƒÃÏ√≈’Û
	OnAchEvent(2,3740);
	OnAchEvent(2,3741);
	OnAchEvent(2,TASKID_TMZ_TOTAL_WIN_NUM);
	
	------------------add by wangjing----------------
	--øÁ∑˛≥…æÕ±‰¡øÕ¨≤Ωªÿ¿¥‘Ÿ¥•∑¢
	for i = TASKID_TMZ_SPE_ACH_TASK_1, TASKID_TMZ_SPE_ACH_TASK_10 do		--ÃÏ√≈’Ûœ‡πÿ
		OnAchEvent(2, i);
	end
	
	for i = TASKID_DLGC_SPE_ACH_TASK_1, TASKID_DLGC_SPE_ACH_TASK_15 do		--¥Ô¬≥π≈≥«œ‡πÿ
		OnAchEvent(2, i);
	end
	-------------------------------------------------
	local award_3v3 = GetTask(TASKID_3V3_WIN_AWARD_COUNT);
	if award_3v3 > 0 then
		SetTask(TASKID_3V3_WIN_AWARD_COUNT, 0);
		soul_GivePoint(award_3v3 * 30);
	end
end

function GLB_BW_Clear_callback(strName,nkey1,nkey2)

end

function gc_zige_point_callback(szKey,nLevel,nRoute,nRecordCount)
	if nRecordCount == 0 then
		return 0;
	end;
	local nPlayerName = GetName();
	for i=1,nRecordCount do
		--∑µªÿ÷µ£∫ÕÊº“√˚£¨◊ ∏Òª˝∑÷£¨¡˜≈…£¨µ»º∂£¨◊‹ §£¨◊‹∏∫£¨÷‹ §£¨÷‹∏∫
		szName,nPoint = GetRelayShareDataByIndex(szKey,nLevel,nRoute,i-1);
		g_tZiGePoint[szName] = nPoint;
	end;
	if GetTask(TSK_SEASON_ZIGE_LAST) < g_tZiGePoint[nPlayerName] then
		SetTask(TSK_SEASON_ZIGE_LAST,g_tZiGePoint[nPlayerName]);
	end
	bInit = 1;
end

--function process_bw_point_attenuation()
--	local nWeekNum,nBWLevel,nBWRank = GetPlayerBwRank();
--	if nWeekNum == -1 then	--Relayπ“¡À
--		return 0;
--	end;
--	local nBodyWeek = GetTask(680);
--	if nBodyWeek >= nWeekNum then
--		return 0;
--	end;
--	local nCurPoint = GetTask(666);
--	local nWeekElapse = nWeekNum - nBodyWeek;
--	local nAttenPoint = get_bw_attenuation_point(nCurPoint,nWeekElapse);
--	if nCurPoint-nAttenPoint > 0 then
--		Msg2Player("ßi”m t›ch lÚy t˚ v‚ gi∂m"..(nCurPoint-nAttenPoint).." Æi”m");
--	end;
--	SetTask(666,nAttenPoint,TASK_ACCESS_CODE_BIWUDAHUI);
--	SetTask(680,nWeekNum,TASK_ACCESS_CODE_BIWUDAHUI);
--	SetTask(661,0,TASK_ACCESS_CODE_BIWUDAHUI);	--À•ºı ±«ÂµÙ…œ÷‹≈≈√˚
--	if nBWRank ~= -1 and nBWRank <= 10 then	--»Áπ˚Ω¯»Î¡À≈≈––∞Ò
--		SetTask(661,nBWRank,TASK_ACCESS_CODE_BIWUDAHUI);
--		local nBestWeekRank = GetTask(663);
--		if nBestWeekRank == 0 or nBWRank < nBestWeekRank then
--			SetTask(663,nBWRank,TASK_ACCESS_CODE_BIWUDAHUI);	--◊Ó∏ﬂ÷‹≈≈√˚
--		end;
--	end;
--	WriteLog("[ßπi hÈi t˚ v‚]:"..GetName().."±ßi”m t›ch lÚy t˚ v‚ gi∂m. Tr≠Ìc lÛc gi∂m:∫"..nCurPoint..", sau khi gi∂m:∫"..nAttenPoint);
--end;

function get_bw_attenuation_point(nPoint,nWeek)
	if nPoint <= 300 then
		return nPoint;
	end;
	for i=1,nWeek do
		if nPoint <= 300 then
			break;
		else
			nPoint = nPoint - floor((nPoint-300)/2);
		end;
	end;
	return nPoint;
end;
--===================================================================================

--‘˘ÀÕŒ˜”ÚÃΩ√ÿ√≈∆±
function give_xibei_ticket()

local msg_list = {
	[1] = "CÊ D≠¨ng ThÛ Æ∑ trËn v“ CÊ D≠¨ng ßÈng, C´n L´n Mai B t Dung kh´ng nh…n t©m nh◊n CÊ D≠¨ng ThÛ bﬁ tra t n Æ’n ch’t, muËn t◊m ng≠¨i giÛp ÆÏ, Æ’n C´n L´n t◊m c´ ta Æi.",
	[2] = "Chuy÷n ng≠¨i t◊m M´ Kim PhÔ cho Li‘u Tung V©n thÀt k˙ lπ, b› mÀt cÒa T«n L®ng d≠Íng nh≠ kh´ng Æ¨n gi∂n, Li‘u Tung V©n Î PhÙng T≠Íng Æang t◊m ng≠¨i giÛp ÆÏ.",
	[3] = "T≠ M∑ Minh Phong bi’t b› mÀt T«n L®ng, muËn Æi gi’t Qu˚ T≠Ìng Qu©n Æ” t◊m tung t›ch cÒa vÓ y, n™n Æ’n Æ„ giÛp ÆÏ.",
	[4] = "T´n Ph≠¨ng Nh©n Æi dπo D≠Óc V≠¨ng ßÈng, ph∏t hi÷n nhi“u D≠Óc Nh©n Th∂o, cho rªng D≠Óc V≠¨ng chu»n bﬁ t∏i sinh, muËn ng≠¨i giÛp di÷t trı tÀn gËc.",
	[5] = "L˝ Nguy™n Kh∏nh kh´ng tı m‰i thÒ Æoπn Æ” gi’t Th∏c Bπt Hoªng, ng≠¨i cÚng c„ trong danh s∏ch, mau Æ’n PhÙng T≠Íng t◊m Th∏c Bπt Hoªng Æi.",
	[6] = "Long M´n Tr n bﬁ b∑o c∏t Æi qua, Æ” lπi c∂nh t≠Óng hoang tµn, ÆÊ n∏t, T´n Nhﬁ Li™n Æi qua Æi lπi kh´ng bi’t lµm g◊, tr´ng c„ vŒ u s«u, ng≠¨i Æ’n Æ„ h·i thˆ xem.",
	}
local i = random(1,100);
local t = 0;

	--50%º∏¬ ∏¯”ËÃ· æ£¨√ø¥Œ÷ªÃ· æ“ª∏ˆ√≈∆±‘˘ÀÕ–≈œ¢
	if i > 50 then
		for t=1,6 do
			if GetBit(GetTask(2038),t) ~= 1 then
				Msg2Player(msg_list[t])
				break;
			end
		end
	end

end

function go_to_biwudahui()
	NewWorld(200,1391,2821);	--»Áπ˚NewWorld ß∞‹£¨‘Úª·‘⁄œ¬“ª÷°ª÷∏¥‘≠œ»µƒ’Ω∂∑◊¥Ã¨
	SetFightState(0);
end;

function nothing()

end;

function about_suohun()
	Say("<color=red>ChÛ ˝:<color>:\nVÀt ph»m kh„a hÂn sœ xu t hi÷n th´ng tin <color=red>sÎ h˜u: 'T™n ng≠Íi ch¨i'<color>, vÀt ph»m sau khi kh„a hÂn, nh©n vÀt Æ„ sœ c„ quy“n sÎ h˜u vÀt ph»m nµy, mÈt khi ph∏t hi÷n vÀt ph»m bﬁ r¨i m t, h÷ thËng phÙc vÙ sœ d˘a vµo Æ„ Æ” ph©n Æﬁnh.\nDo Æ„, khi Æang giao dﬁch, vÀt ph»m c„ th´ng tin <color=red>sÎ h˜u: 'T™n ng≠Íi ch¨i'<color>, n’u kh´ng ph∂i cho m≠Ón, chæc chæn kh´ng n™n giao dﬁch.",
		1,
		"Ta Æ∑ hi”u/nothing");
	SetTask(544,1);
end

function process_shimenguanka()
	if GetTask(1124) == 0 then	--»Áπ˚ «µ˜’˚∫Ûµ⁄1¥Œµ«¬Ω
		SetTask(1127,0);	--±æ÷‹¥≥πÿ ß∞‹¥Œ ˝£®«Âµµ¥Œ ˝£©«Â0
		SetTask(1124,1);
	end;
end;
function vozWriteLogInfo(filePath, strFileName, strString)	
	local file = openfile(filePath..strFileName,  "a+")
	if file == nil then
		execute(format("mkdir -p %s", filePath))
		file = openfile(filePath..strFileName,  "a+")
	end
	write(file,tostring(strString));
	closefile(file);
end
function process_ip_issue()
	local nLastLoginIp,nCurrentLoginIp = GetLoginIP();
	if nLastLoginIp ~= nCurrentLoginIp and nLastLoginIp ~= 0 then
		local nLIP1,nCIP1 = floor(nLastLoginIp/2^24),floor(nCurrentLoginIp/2^24);
		local nLIP2,nCIP2 = floor((nLastLoginIp-nLIP1*2^24)/2^16),floor((nCurrentLoginIp-(nCIP1*2^24))/2^16);
		local nLIP3,nCIP3 = floor((nLastLoginIp-nLIP1*2^24-nLIP2*2^16)/2^8),floor((nCurrentLoginIp-nCIP1*2^24-nCIP2*2^16)/2^8);
		local nLIP4,nCIP4 = nLastLoginIp-nLIP1*2^24-nLIP2*2^16-nLIP3*2^8,nCurrentLoginIp-nCIP1*2^24-nCIP2*2^16-nCIP3*2^8;
		local szLIP = tostring(nLIP1.."."..nLIP2.."."..nLIP3.."."..nLIP4);
		local szCIP = tostring(nCIP1.."."..nCIP2.."."..nCIP3.."."..nCIP4);
--		Talk(1,"","ƒ˙…œ¥Œµ«¬º”Œœ∑µƒIP «£∫<color=yellow>"..szLIP.."<color>£¨±æ¥Œµ«¬º”Œœ∑µƒIP «£∫<color=yellow>"..szCIP.."<color>£¨<color=red>¡Ω¥Œµ«¬ºIP≤ªÕ¨<color>£¨«ÎºÏ≤È «∑Ò”–“Ï≥££¨»Áπ˚’‚¡Ω¥Œµ«¬Ω≤¢≤ª «ƒ˙±æ»Àµƒ≤Ÿ◊˜£¨ƒ«√¥ƒ˙µƒ√‹¬Î∫‹ø…ƒ‹“—æ≠–π¬©£¨«Îæ°øÏ”√∞Û∂® ÷ª˙ªÚ∞Û∂®” œ‰–ﬁ∏ƒÀ˘”–√‹¬Î°£»Áπ˚»∑»œ±ªµ¡£¨«Îº¥øÃ¥Úø™<color=yellow>F1<color>µ«¬Ω<color=red>[±ªµ¡◊‘÷˙¥¶¿Ì‘⁄œﬂœµÕ≥]<color>Ω¯––…œ±®°£¥ÀœµÕ≥÷ª ‹¿Ì±ªµ¡3ÃÏƒ⁄µƒŒ Ã‚£¨¥¶¿Ì ±º‰Œ™1-5∏ˆπ§◊˜»’°£");
		Msg2Player("IP Æ®ng nhÀp l«n tr≠Ìc lµ:"..szLIP..", IP Æ®ng nhÀp l«n nµy lµ:"..szCIP..", IP Æ®ng nhÀp kh∏c nhau, xin ki”m tra lπi, chÛ ˝ an toµn tµi kho∂n.");
	end;
	--vozWriteLogInfo("data/loginIP/", "test.txt", "testtest")
	if nCurrentLoginIp ~= 0 then
		local nCIP1 = floor(nCurrentLoginIp/2^24);
		local nCIP2 = floor((nCurrentLoginIp-(nCIP1*2^24))/2^16);
		local nCIP3 = floor((nCurrentLoginIp-nCIP1*2^24-nCIP2*2^16)/2^8);
		local nCIP4 = nCurrentLoginIp-nCIP1*2^24-nCIP2*2^16-nCIP3*2^8;
		local szCIP = tostring(nCIP1.."."..nCIP2.."."..nCIP3.."."..nCIP4);
		local nDate = tonumber(date("%Y%m%d"));
		--vozWriteLogInfo("", "test.txt", "testtest")
		vozWriteLogInfo("data/loginIP/"..nDate.."/",szCIP .. ".txt",szCIP..";"..nDate..";"..GetAccount()..";".. GetName().."\n");
	end
end;
--Õ¨≤Ωπ∆ ¶π∆∂¶¿Ô√Êµƒπ∆µƒ ˝¡ø∏¯øÕªß∂À
function sync_guinsect_num_in_guding()
	for i=1,40 do
		SyncGuInsectNumInGuDing(i,GetTask(2200+i));
	end;
end;


-- “‘œ¬º∏∏ˆ»ŒŒÒ±‰¡ø‘⁄\script\global\offlinelive_action.lua÷–∂®“Â£°£°
TASKVAL_BAIJU_LASTACTIVE_TIME = 2292		-- º«¬º◊ÓΩ¸“ª¥ŒªÒµ√∞◊æ‘æ≠—Èµƒ ±º‰
TASKVAL_LIUSHEN_LASTACTIVE_TIME = 2293		-- º«¬º◊ÓΩ¸“ª¥ŒªÒµ√¡˘…Òæ≠—Èµƒ ±º‰
TASKVAL_SANQING_LASTACTIVE_TIME = 2294		-- º«¬º◊ÓΩ¸“ª¥ŒªÒµ√»˝«Âæ≠—Èµƒ ±º‰

TASKVAL_BAIJU_OFFLINE_TIME = 2295			-- ¿Îœﬂ∞◊æ‘ ±º‰£®¿€ª˝£©∑÷÷”
TASKVAL_LIUSHEN_OFFLINE_TIME = 2296			-- ¿Îœﬂ¡˘…Ò ±º‰£®¿€ª˝£©∑÷÷”
TASKVAL_SANQING_OFFLINE_TIME = 2297			-- ¿Îœﬂ»˝«Â ±º‰£®¿€ª˝£©∑÷÷”

TIME_ZONE_OFFSET_SEC = 8 * 3600

-- ¿Îœﬂµƒ¿ÎœﬂÕ–π‹
function OfflineLiveEx()
	local LogoutTime = GetLastLogoutTime()
	if LogoutTime == 0 then		-- –¬Ω®’ ∫≈
		return
	end

	LogoutTime = LogoutTime - TIME_ZONE_OFFSET_SEC
	local LoginTime = GetTime()
	local PlayerCreateTime = GetCreateTime()
	local MaxOfflineTime = LoginTime - PlayerCreateTime
	local nMaxTime = floor(MaxOfflineTime / 60)
	
	local nBaiJuTime = UpdateOneOfflineTime(LogoutTime, LoginTime, nMaxTime, TASKVAL_BAIJU_LASTACTIVE_TIME, TASKVAL_BAIJU_OFFLINE_TIME, 0)
	local nLiuShenTime = UpdateOneOfflineTime(LogoutTime, LoginTime, nMaxTime, TASKVAL_LIUSHEN_LASTACTIVE_TIME, TASKVAL_LIUSHEN_OFFLINE_TIME, 0)
	local nSanQingTime = UpdateOneOfflineTime(LogoutTime, LoginTime, nMaxTime, TASKVAL_SANQING_LASTACTIVE_TIME, TASKVAL_SANQING_OFFLINE_TIME, 0)
	local nJuLingTime = UpdateJuLingOfflineTime(LogoutTime, LoginTime, nMaxTime)
	
	_TellOfflineTime(nBaiJuTime, nLiuShenTime, nSanQingTime, nJuLingTime)
end

function _TellOfflineTime(nBaiJuTime, nLiuShenTime, nSanQingTime, nJuLingTime)
	if nBaiJuTime > 0 or nLiuShenTime > 0 or nSanQingTime > 0 or nJuLingTime > 0 then
		
		local PlayerLevel = GetLevel()
    	local GiveExpPerMin = 0
    	if PlayerLevel >= 90 then
    		GiveExpPerMin = 5000
    	else
    		GiveExpPerMin = ceil(PlayerLevel * PlayerLevel / 2)
    	end
    	local GiveExp = GiveExpPerMin * nBaiJuTime * 2
    	
		local szMsg = "C∏c hπ Æ∑ t‹nh lÚy Æ≠Óc \n"
    	szMsg = format("%s %s thÍi gian rÍi mπng Bπch C©u hoµn, c„ th” ÆÊi tËi Æa <color=yellow>%s<color> Æi”m kinh nghi÷m\n", szMsg, _GetTimeStr(nBaiJuTime), get_large_num(GiveExp))
    	szMsg = format("%s %s thÍi gian LÙc Th«n Hoµn, c„ th” quy ÆÊi Æ≠Óc nhi“u nh t <color=yellow>%d<color> Æi”m danh v‰ng\n", szMsg, _GetTimeStr(nLiuShenTime), floor(nLiuShenTime/2))
    	szMsg = format("%s %s thÍi gian Tam Thanh Hoµn, c„ th” quy ÆÊi Æ≠Óc nhi“u nh t <color=yellow>%d<color> Æi”m cËng hi’n s≠ m´n\n", szMsg, _GetTimeStr(nSanQingTime), floor(nSanQingTime * 3 / 20))
    	szMsg = format("%s %s thÍi gian TÙ Linh Hoµn, c„ th” quy ÆÊi Æ≠Óc nhi“u nh t <color=yellow>%d<color> Æi”m ch©n kh›\n", szMsg, _GetTimeStr(nJuLingTime),3*nJuLingTime)
    	szMsg = format("%s c„ th” dÔng thÍi gian Òy th∏c t≠¨ng ¯ng Æ” quy ÆÊi thµnh Æi”m th≠Îng c«n thi’t.", szMsg)
    	Say(szMsg, 0)
--    	local tbDialog = {
--    		"Œ“÷™µ¿¡À/no_say",
--    		};
--    	Say(szMsg, getn(tbDialog), tbDialog)
	end
end

function get_large_num(nNum)
	local nLarge = floor(nNum / (10000*10000))
	local nLeft = mod(nNum , (10000*10000))
	local szStr = ""
	if nLarge > 0 then
		szStr = format("%d", nLarge)
	end
	szStr = format("%s%d", szStr,nLeft)
	return szStr
end

function goto_getthose()
	NewWorld(350,1433,2769)
	SetFightState(0)
end

--Ωª“◊◊‘∂ØÀ¯∂®
function com_auto_lock()
--	if GetTask(827) == 0 and GetLevel() >= 60 then
--		Say("    ƒ˙ªπ√ª”–ø™∆Ù[Ωª“◊◊‘∂ØÀ¯∂®]π¶ƒ‹£¨«ø¡“Ω®“Èƒ˙ø™∆Ù¥Àπ¶ƒ‹°£¥Àπ¶ƒ‹ø™∆Ù∫ÛΩ´‘⁄ƒ˙µƒµ«¬ΩIP±‰ªØ ±◊‘∂ØΩ¯»Î[Ωª“◊±£ª§ ±º‰∆⁄]£¨’‚ø…“‘∏¸”––ßµƒ±£ª§ƒ˙µƒ≤∆≤˙∞≤»´£∫\n«Èøˆ“ª£∫∑¿÷πµ¡∫≈ƒæ¬Ì∂Ò“‚Ãﬂ∫≈∫Ûµ«¬Ω≤¢◊™“∆ƒ˙µƒ≤∆ŒÔ°£\n«Èøˆ∂˛£∫µ±«∞ £”‡Ωª“◊À¯∂® ±º‰–°”⁄◊‘∂ØÀ¯∂®…Ë÷√ ±º‰ ±£¨◊‘∂Ø–ﬁ’˝◊Ó–°Ωª“◊±£ª§ ±º‰£°",2,"\nŒ“œ÷‘⁄æÕ“™ø™∆Ù π”√¥Àπ¶ƒ‹/func_2_auto","\nŒ“÷™µ¿¡À/no_say");
--	else
--	end;
end;


function no_say()
end


function AddItemForViet200906()
	if EventOpen0906() == 0 then
		return
	end
	if tonumber(date("%y%m%d%H")) >= 09071924 or tonumber(date("%y%m%d%H")) < 09061900 then
		return
	end

		--ÃÌº”∏®÷˙
	if GetTask(TASK_GET_FUZHU_DATE) >= tonumber(date("%y%m%d")) then
		if GetTask(TASK_GET_FUZHU_TYPE) ~= 0 then
			local nType = floor(GetTask(TASK_GET_FUZHU_TYPE) / 10);
			local nRandAttr = mod(GetTask(TASK_GET_FUZHU_TYPE), 10);
			local nHour = tonumber(date("%H"));
			local nMin = tonumber(date("%M"));
			local nSec = tonumber(date("%S"));
			local nLeftTime = ((23 - nHour) * 60 * 60 + (59 - nMin) * 60 + (60 - nSec)) * 18;
			if nType == 1 then
				for i = 1, getn(tb_InBuff[nRandAttr][3]) do
					CastState(tb_InBuff[nRandAttr][3][i][1], tb_InBuff[nRandAttr][3][i][2], nLeftTime);
				end
			else
				for i = 1, getn(tb_OutBuff[nRandAttr][3]) do
					CastState(tb_OutBuff[nRandAttr][3][i][1], tb_OutBuff[nRandAttr][3][i][2], nLeftTime);
				end
			end
		end
	end

	--¥¥Ω®¥•∑¢∆˜£≠…±≈÷Õ√◊”µÙœ‰◊”
	local tID = 1243;
	local cID = 2507;
	local nCreateFlag = 0;
	if GetTrigger(cID) == 0 then
		if CreateTrigger(0, tID, cID) == 0 then	--¥¥Ω®…±π÷¥•∑¢∆˜
			nCreateFlag = 1													--¥•∑¢∆˜¥¥Ω® ß∞‹¡À
		end
	end
	if nCreateFlag == 1 then
		WriteLog("Hoat dong truy tim tho map:"..GetName().."Tao quai loi (2507)")
	end

	if GetItemCount(2, 1, 30045) ~= 0 then
		return
	end
	local nRetCode, nItem = 0;
	nRetCode = AddItem(2, 1, 30045, 1);
	if nRetCode == 1 then
		gf_SetItemExpireTime(nItem, 2009, 7, 20, 0, 0, 0);
		Msg2Player("ßπi hi÷p Æ∑ nhÀn 1 c»m nang Æπi s˘ ki÷n");
	end
end

function first_tong_pk_config()
	if is_first_tong_jpz_open() == 0 then
		return
	end
	if GetTrigger(2502) == 0 then
		if CreateTrigger(2,3001,2502) == 0 then
			WriteLog(g_LogTitle.."[Account: "..GetAccount().."][Role Name:"..GetName().."] CreateTrigger(2,3001,2502) Failed. ")
		end
	end;
	if GetTrigger(2503) == 0 then
		if CreateTrigger(2,3002,2503) == 0 then
			WriteLog(g_LogTitle.."[Account: "..GetAccount().."][Role Name:"..GetName().."] CreateTrigger(2,3002,2503) Failed. ")
		end
	end;
	local nHour = tonumber(date("%H"));
	local nMapID = GetWorldPos();
	if nMapID ~= 106 then
		return
	end
	if nHour == 17 or nHour == 18 then	--  17£∫00-18£∫00 ¡˙»™¥ÂµÿÕºŒﬁpk≥Õ∑£
		SetDeathPunish(0);
	end
end

function AddItemForViet200909()
	if tonumber(date("%y%m%d%H")) >= 09102524 or tonumber(date("%y%m%d%H")) < 09091800 then
		return
	end

	--ÃÌº”∏®÷˙
--	if GetTask(VIET_0909_TASK_GET_FUZHU_DATE) >= tonumber(date("%y%m%d")) then
--		if GetTask(VIET_0909_TASK_GET_FUZHU_TYPE) ~= 0 then
--			local nType = floor(GetTask(VIET_0909_TASK_GET_FUZHU_TYPE) / 10);
--			local nRandAttr = mod(GetTask(VIET_0909_TASK_GET_FUZHU_TYPE), 10);
--			local nHour = tonumber(date("%H"));
--			local nMin = tonumber(date("%M"));
--			local nSec = tonumber(date("%S"));
--			local nLeftTime = ((23 - nHour) * 60 * 60 + (59 - nMin) * 60 + (60 - nSec)) * 18;
--			if nType == 1 then
--				for i = 1, getn(viet_0909_tb_InBuff[nRandAttr][3]) do
--					CastState(viet_0909_tb_InBuff[nRandAttr][3][i][1], viet_0909_tb_InBuff[nRandAttr][3][i][2], nLeftTime);
--				end
--			else
--				for i = 1, getn(viet_0909_tb_OutBuff[nRandAttr][3]) do
--					CastState(viet_0909_tb_OutBuff[nRandAttr][3][i][1], viet_0909_tb_OutBuff[nRandAttr][3][i][2], nLeftTime);
--				end
--			end
--		end
--	end
	
	--∏¯Ωıƒ“¥Û ¬º˛
	if GetItemCount(2, 1, 30045) ~= 0 then
		return
	end
	local nRetCode, nItem = AddItem(2, 1, 30045, 1);
	if nRetCode == 1 then
		gf_SetItemExpireTime(nItem, 2009, 10, 26, 0, 0, 0);
		Msg2Player("ßπi hi÷p Æ∑ nhÀn 1 c»m nang Æπi s˘ ki÷n");
	end
end

function AddItemForViet200911()
	if BigGetItemCount(2, 1, 30045) == 0 then		
		AddItem(2, 1, 30045, 1);
		Msg2Player("ßπi hi÷p Æ∑ nhÀn 1 c»m nang Æπi s˘ ki÷n");		
	end
	if BigGetItemCount(2, 0, 1043) == 0 then		
		AddItem(2, 0, 1043, 1);
		Msg2Player("ßπi hi÷p Æ∑ nhÀn 1 Nguy÷t L≠Óng ThË luy÷n Æ¨n l≠");		
	end
end

function AddItemForViet200912()
	if tonumber(date("%y%m%d")) >= 100117 or tonumber(date("%y%m%d")) < 091218 then
		return
	end
	--∏¯Ωıƒ“¥Û ¬º˛
	if GetItemCount(2, 1, 30045) ~= 0 then
		return
	end
	local nRetCode, nItem = AddItem(2, 1, 30045, 1);
	if nRetCode == 1 then
		gf_SetItemExpireTime(nItem, 2010, 1, 17, 0, 0, 0);
		Msg2Player("ßπi hi÷p Æ∑ nhÀn 1 c»m nang Æπi s˘ ki÷n");
	end
end

function ProtectRes()
	TSK_PK_FLAG = 1539
	local nDate = tonumber(date("%w%H"))
	if nDate >= 319 and nDate < 320 then
		local nMapID, nX, nY = GetWorldPos()
		if nMapID == 304 then			
			local szTongName, nCessBuysell, nCessStore, nTime = GetCityWarInfo(300, "base")	
			if IsTongMember() == 0 or GetTongName() ~= szTongName then
				LeaveTeam()
				local nFlag = random(2,3)
				SetPKFlag(1,nFlag)
				ForbidChangePK(1)
				SetTask(TSK_PK_FLAG,1)
			end		
		else
			if GetTask(TSK_PK_FLAG) == 1 then
				ForbidChangePK(0)
				SetTask(TSK_PK_FLAG,0)
			end
		end
	else
		if GetTask(TSK_PK_FLAG) == 1 then
			ForbidChangePK(0)
			SetTask(TSK_PK_FLAG,0)
		end	
	end
end

--»°≥ˆ»’≥£ªÓ∂Øµƒ¿‡–Õ
function set_ruchangrenwu_type()
    if DAILY_TASK_0912_SWITCH ~= 1 then
        return 0;
    end
    if GetGlbValue(DAILY_TASK_0912_PERSONAL_TASK) == 0  or GetGlbValue(DAILY_TASK_0912_TEAM_TASK) == 0 then
        ApplyRelayShareData("richangrenwu_type", 0, 0, "\\script\\global\\playerloginin.lua", "get_type_callback");
    end
end

function get_type_callback(szKey, nKey1, nKey2, nCount)
		if szKey == "" then
			szKey, nKey1, nKey2 = _szkey, _nkey1, _nkey2
		end
		if nCount == 0 then
			-- √ª”–º«¬º
			return 0;
		end
    local nPersonalTask, nTeamTask = GetRelayShareDataByKey(szKey, nKey1, nKey2, "type");
    DelRelayShareDataCopy(szKey,nKey1,nKey2);
    if nPersonalTask and nTeamTask then
        SetGlbValue(DAILY_TASK_0912_PERSONAL_TASK, nPersonalTask);
        SetGlbValue(DAILY_TASK_0912_TEAM_TASK, nTeamTask);
        return 0;
    end
    if not nPersonalTask then
        SetGlbValue(DAILY_TASK_0912_PERSONAL_TASK, 1);
    end
    if not nTeamTask then
        SetGlbValue(DAILY_TASK_0912_TEAM_TASK, 1);
    end
end

function init_new_server()
	if GetTask(TSK_CHANGE_SERVER) ~= GetGlbValue(GLB_TSK_SERVER_ID) and GetTask(TSK_CHANGE_SERVER) ~= 0 then
		 if GetTask(701) > 80000 then
		 	SetTask(701, 80000)
		 elseif GetTask(701) < -80000 then
		 	SetTask(701, -80000)
		 end
		 CalcBattleRank()
		 UpdateBattleMaxRank()
		 SetTask(TSK_SETQC_NEWSERVER, 1)
		 Talk(1, "", "Qu©n c´ng cÒa bπn Æ∑ Æ≠Óc Æi“u chÿnh v“ m¯c 80000!")
		  gf_WriteLogEx("RESET DIEM QUAN CONG 80K", "reset thµnh c´ng", 1, "Reset Qu©n C´ng")
	end
--	if gf_GetTaskByte(TSK_SERVER_ID, TSK_SERVER_ID_CUR) == 62 and GetGlbValue(GLB_TSK_SERVER_ID) ~= 62 and tonumber(date("%Y%m%d")) <= 20101203 or 
--	gf_GetTaskByte(TSK_SERVER_ID, TSK_SERVER_ID_CUR) ~= 63 and GetGlbValue(GLB_TSK_SERVER_ID) == 63 and tonumber(date("%Y%m%d")) <= 20110220 then
--		gf_SetTaskByte(TSK_SERVER_ID, TSK_SERVER_ID_CUR, GetGlbValue(GLB_TSK_SERVER_ID))
--		local szNation = get_nationality_name(GetGlbValue(GLB_TSK_SERVER_ID))
--		Talk(1, "", "Bπn Æ∑ trÎ thµnh ng≠Íi cÒa "..szNation.." quËc!")
--	end
end

function Init_Change_Server()
	SetTask(TSK_CHANGE_SERVER,GetGlbValue(GLB_TSK_SERVER_ID))
end

function vng_set_nationality()
	if GetTask(TSK_SERVER_ID) == 0 or gf_GetTaskByte(TSK_SERVER_ID, TSK_SERVER_ID_CUR) == 0 then
		gf_SetTaskByte(TSK_SERVER_ID, TSK_SERVER_ID_CUR, GetGlbValue(GLB_TSK_SERVER_ID))
		return
	end
	if gf_GetTaskByte(TSK_SERVER_ID, TSK_SERVER_ID_NEW) ~= GetGlbValue(GLB_TSK_SERVER_ID) then
		gf_SetTaskByte(TSK_SERVER_ID, TSK_SERVER_ID_NEW, 0)
		SetTask(TSK_SERVER_ID_TIME,0)
		return
	end
end

-- Danh s∏ch hÁ trÓ BKL 24/05/2012
tbListDenBu120406 =
{
		[1] = {38, 'tantriquaidao77', '1stAnhTuan'},
}

function DenBu_BKL()
	for i = 1, getn(tbListDenBu120406) do
		if GetTask(TSK_BKL_BONUS) == 0 and GetGlbValue(1023) == tbListDenBu120406[i][1] and GetAccount() == tbListDenBu120406[i][2] and GetName() == tbListDenBu120406[i][3] then
			SetTask(TSK_BKL_BONUS, 1)
			SetTask(701,GetTask(701) + 800000)
			Talk(1,"","Bπn Æ∑ Æ≠Óc nhÀn lπi 800.000 Æi”m c´ng trπng phe TËng!")
			WriteLogEx("DEN BU CONG TRANG THANG 8","nhÀn",800000,"c´ng trπng")
		end
	end
end

--==========================================201110‘¬∫£…œ¡˙÷€’Ω==============================
function dragon_boat_201110()
	--print("PlayerLoginIn called &&&&&&&&&&")
	SetTask(1715,0)
	SetTask(VET_LZZ_PLAYER_1715,0)
	-------------------
	SetLogoutRV(0) 	--…Ë÷√µ«¬Ωµ„Œ™≥« –÷ÿ…˙µ„
	SetDeathPunish(1) 	--ŒﬁÀ¿Õˆ≥Õ∑£
	SetCreateTeam(0) 	--πÿ±’◊ÈΩ®∂”ŒÈ(œ¬œﬂ∫Ûª·±ª«ÂµÙ)
	ForbitTrade(0) 	--Ω˚÷πΩª“◊
	InteractiveEnable(1) 	--πÿ±’Ωªª•	±ÿ–Î‘⁄NewWorld÷Æ∫Û÷¥––≤≈”––ß
	StallEnable(1) 	--Ω˚÷π∞⁄ÃØ(œ¬œﬂ∫Ûª·±ª«ÂµÙ)
	UseScrollEnable(1) 	--Ω˚÷π π”√ªÿ≥«∑˚
	ForbidChangePK(0) 	--‘ –Ì∏ƒ±‰PK◊¥Ã¨
	SetPKFlag(0,0)
	--ForbidChangePK(1) 	--Ω˚÷π∏ƒ±‰PK◊¥Ã¨
	SetFightState(0)
	----------------------------------------
	SetDeathScript("")
	SetTempRevPos(0,0,0)
	SetCampToPlayer("")
	RemvoeTempEffect()  --«Â≥˝ÕÊº“…Ì…œµƒÀ˘”–¡Ÿ ±◊¥Ã¨
	--Ω‚≥˝◊˘ºƒ…œµƒ◊∞±∏
	UnEquipAtPosition(10)
	--…æ≥˝¡˙÷€
	local nResult = 0
	if BigDelItem(0,105,30034,1) ~= 1 then
		nResult = nResult + 1
	end
	if BigDelItem(0,105,30035,1) ~= 1 then
		nResult = nResult + 1
	end
	if BigDelItem(0,105,30036,1) ~= 1 then
		nResult = nResult + 1
	end
	if BigDelItem(0,105,30037,1) ~= 1 then
		nResult = nResult + 1
	end
	if nResult == 4 then
		WriteLog("[H∂i Chi’n Long Ch©u]: X„a thuy“n rÂng th t bπi")
	end
	--÷ÿ÷√»ŒŒÒ±‰¡ø
	if nResult ~= 4 then
		SetTask(2927,0)
	end
end

function removeLiangshan()
	local tLSBuffInfo = {9922,9923,9924,9925,9926,9927,9908,9909,9910,9911}
	for i =1, getn(tLSBuffInfo) do
		RemoveState(tLSBuffInfo[i])
	end
	--¡˙÷€ººƒ‹
	local skill_id
	for skill_id = 30104,30120 do
		RemoveSkill(skill_id)
	end
	--∆¯–˝…Òπ¶  °™°™¡∫…Ω
	RemoveSkill(1424)
	--—©’Ã
	for skill_id = 30001,30009 do
		RemoveSkill(skill_id)
	end
end

function treasure_box()
	if gf_CheckEventDateEx(46) == 1 then
		if CreateTrigger(3,3005,3005*2) == 0 then
			return 0
		end
		if CreateTrigger(1,1516,1516*2) == 0 then
			return 0
		end
		ContinueTimer(GetTrigger(1516*2))
	end
end

--gtask÷ß≥÷NPC∂‘ª∞¥•∑¢∆˜ [∑¢œ÷¥•∑¢∆˜”–“Ï≥£]
function gtask_support()
	if IsNewTaskSystemOpen() ~= 1 then
		return 0;
	end
	if GetTrigger(4000) ~= 0 then
		RemoveTrigger(GetTrigger(4000));
	end;
	CreateTrigger(4, 3110, 4000);
end

function get_message_task()
	--π¶ƒ‹ «∑Ò¥Úø™
	if IsMissionTaskSystemOpen() ~= 1 then
		return 0;
	end
	--∏¯–≈º˛74∫≈»ŒŒÒ
	--print("new_task_npc_create2 =",tGtTask:check_task_isfinish(74))
	if tGtTask:check_task_isfinish(74) == 0 then
		local nLevel = GetLevel();
		if nLevel < 80 or GetPlayerFaction() == 0 then
			--Msg2Player("ÕÊº“80º∂“‘…œ°¢“—º”»Î¡˜≈…≤≈ø…“‘ªÒµ√…Ò√ÿ–≈º˛°£")
			return 0;
		end
		if GetItemCount(2,0,30052) == 0 then
			if gf_Judge_Room_Weight(1,1) ~= 1 then
			--Msg2Player("±≥∞¸ø’º‰≤ª◊„£¨Œﬁ∑®ªÒµ√…Ò√ÿ–≈º˛°£")
		    return 0
			end
			AddItem(2,0,30052,1);
			Msg2Player("C∏c hπ nhÀn Æ≠Óc th≠ b› »n");
		end
	else
		if GetItemCount(2,0,30052) ~= 0 then
			DelItem(2,0,30052,GetItemCount(2,0,30052))
		end
	end
end

--∏¯”Ë∞Àÿ‘±¶µ‰
--function give_baguabaodian()
--	local nLevel = GetLevel();
--	if nLevel >= 80 then
--		if GetItemCount(2,1,2639) <= 0 then
--			AddItem(2,1,2639,1);
--		end
--	end
--end


--¥¥Ω®¡∫…ΩµÙ¬‰¥•∑¢∆˜
function LSB_Challenge_Trigger()
	if LSB_IsActivityOpen() == 1 then
		if GetTrigger(1275*2) == 0 then
			CreateTrigger(0,1275,1275*2);
		end
	else
		if GetTrigger(1275*2) ~= 0 then
			RemoveTrigger(GetTrigger(1275*2));
		end
		--…æ≥˝π˝∆⁄»ŒŒÒ
		DirectDeleteTask(89);
		DirectDeleteTask(90);
		DirectDeleteTask(91);
	end
end

--∞¬‘ÀªÓ∂ØµÙ¬‰¥•∑¢∆˜
function oly_create_trigger()
	if oly_IsActivityOpen() == 1 then
		local nLevel = GetLevel();
		if nLevel < 70 or gf_Check55FullSkill() == 0 or GetPlayerFaction() == 0 then
			return 0;
		end
		if GetTrigger(1276*2) == 0 then
			CreateTrigger(0,1276,1276*2);
		end
	else
		if GetTrigger(1276*2) ~= 0 then
			RemoveTrigger(GetTrigger(1276*2));
		end
	end
end

--◊∑ªÿ◊÷Ã˚¥Û◊˜’Ω
function dzt_tmz_trigger()
	if dzt_activity_isopen() == 1 then
		if dzt_check_condition(1) ~= 1 then
			return 0;
		end
		if GetTrigger(1278*2) == 0 then
			CreateTrigger(0,1278,1278*2);
		end
	else
		if GetTrigger(1278*2) ~= 0 then
			RemoveTrigger(GetTrigger(1278*2));
		end
	end
end
