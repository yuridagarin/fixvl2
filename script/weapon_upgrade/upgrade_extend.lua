--=============================================
--Created by PhucBDB
--Upgrade weapon
--=============================================
tb_upgrade_nltq =
{
			[1] = {{0,103,30017}, "Ngù Long Tèng T­íng Qu©n ChiÕn Kh«i"},
			[2] = {{0,103,30018}, "Ngù Long Tèng T­íng Qu©n ChiÕn Kh«i"},
			[3] = {{0,103,30019}, "Ngù Long Tèng T­íng Qu©n ChiÕn Kh«i"},
			[4] = {{0,103,30020}, "Ngù Long Tèng T­íng Qu©n ChiÕn Kh«i"},
			[5] = {{0,103,30021}, "Ngù Long Liªu T­íng Qu©n ChiÕn Kh«i"},
			[6] = {{0,103,30022}, "Ngù Long Liªu T­íng Qu©n ChiÕn Kh«i"},
			[7] = {{0,103,30023}, "Ngù Long Liªu T­íng Qu©n ChiÕn Kh«i"},
			[8] = {{0,103,30024}, "Ngù Long Liªu T­íng Qu©n ChiÕn Kh«i"},
			[9] = {{0,100,30017}, "Ngù Long Tèng T­íng Qu©n ChiÕn Bµo"},
			[10] = {{0,100,30018}, "Ngù Long Tèng T­íng Qu©n ChiÕn Bµo"},
			[11] = {{0,100,30019}, "Ngù Long Tèng T­íng Qu©n ChiÕn Bµo"},
			[12] = {{0,100,30020}, "Ngù Long Tèng T­íng Qu©n ChiÕn Bµo"},
			[13] = {{0,100,30021}, "Ngù Long Liªu T­íng Qu©n ChiÕn Bµo"},
			[14] = {{0,100,30022}, "Ngù Long Liªu T­íng Qu©n ChiÕn Bµo"},
			[15] = {{0,100,30023}, "Ngù Long Liªu T­íng Qu©n ChiÕn Bµo"},
			[16] = {{0,100,30024}, "Ngù Long Liªu T­íng Qu©n ChiÕn Bµo"},
			[17] = {{0,101,30017}, "Ngù Long Tèng T­íng Qu©n ChiÕn Trang"},
			[18] = {{0,101,30018}, "Ngù Long Tèng T­íng Qu©n ChiÕn Trang"},
			[19] = {{0,101,30019}, "Ngù Long Tèng T­íng Qu©n ChiÕn Trang"},
			[20] = {{0,101,30020}, "Ngù Long Tèng T­íng Qu©n ChiÕn Trang"},
			[21] = {{0,101,30021}, "Ngù Long Liªu T­íng Qu©n ChiÕn Trang"},
			[22] = {{0,101,30022}, "Ngù Long Liªu T­íng Qu©n ChiÕn Trang"},
			[23] = {{0,101,30023}, "Ngù Long Liªu T­íng Qu©n ChiÕn Trang"},
			[24] = {{0,101,30024}, "Ngù Long Liªu T­íng Qu©n ChiÕn Trang"},
			[25] = {{0,102,30017}, "Ngù Long Tèng T­íng Qu©n LÖnh Kú"},
			[26] = {{0,102,30018}, "Ngù Long Tèng T­íng Qu©n LÖnh Kú"},
			[27] = {{0,102,30019}, "Ngù Long Tèng T­íng Qu©n LÖnh Kú"},
			[28] = {{0,102,30020}, "Ngù Long Tèng T­íng Qu©n LÖnh Kú"},
			[29] = {{0,102,30029}, "Ngù Long Liªu T­íng Qu©n LÖnh Kú"},
			[30] = {{0,102,30030}, "Ngù Long Liªu T­íng Qu©n LÖnh Kú"},
			[31] = {{0,102,30031}, "Ngù Long Liªu T­íng Qu©n LÖnh Kú"},
			[32] = {{0,102,30032}, "Ngù Long Liªu T­íng Qu©n LÖnh Kú"},
			[33] = {{0,102,30021}, "Ngù Long Tèng T­íng Qu©n LÖnh Phï"},
			[34] = {{0,102,30022}, "Ngù Long Tèng T­íng Qu©n LÖnh Phï"},
			[35] = {{0,102,30023}, "Ngù Long Tèng T­íng Qu©n LÖnh Phï"},
			[36] = {{0,102,30024}, "Ngù Long Tèng T­íng Qu©n LÖnh Phï"},
			[37] = {{0,102,30033}, "Ngù Long Liªu T­íng Qu©n LÖnh Phï"},
			[38] = {{0,102,30034}, "Ngù Long Liªu T­íng Qu©n LÖnh Phï"},
			[39] = {{0,102,30035}, "Ngù Long Liªu T­íng Qu©n LÖnh Phï"},
			[40] = {{0,102,30036}, "Ngù Long Liªu T­íng Qu©n LÖnh Phï"},
			[41] = {{0,102,30013}, "Ngù Long Tèng T­íng Qu©n LÖnh Bµi"},
			[42] = {{0,102,30014}, "Ngù Long Tèng T­íng Qu©n LÖnh Bµi"},
			[43] = {{0,102,30015}, "Ngù Long Tèng T­íng Qu©n LÖnh Bµi"},
			[44] = {{0,102,30016}, "Ngù Long Tèng T­íng Qu©n LÖnh Bµi"},
			[45] = {{0,102,30025}, "Ngù Long Liªu T­íng Qu©n LÖnh Bµi"},
			[46] = {{0,102,30026}, "Ngù Long Liªu T­íng Qu©n LÖnh Bµi"},
			[47] = {{0,102,30027}, "Ngù Long Liªu T­íng Qu©n LÖnh Bµi"},
			[48] = {{0,102,30028}, "Ngù Long Liªu T­íng Qu©n LÖnh Bµi"},
}

function upgrade_nltq_clothes()
	local tSay = {}
	tinsert(tSay, "N©ng cÊp Tèng Liªu Ngù Long T­íng Qu©n ChiÕn Kh«i/#Upgrade_NLTQ(0)")
	tinsert(tSay, "N©ng cÊp Tèng Liªu Ngù Long T­íng Qu©n ChiÕn Bµo/#Upgrade_NLTQ(1)")
	tinsert(tSay, "N©ng cÊp Tèng Liªu Ngù Long T­íng Qu©n ChiÕn Trang/#Upgrade_NLTQ(3)")
	tinsert(tSay, "N©ng cÊp Tèng Liªu Ngù Long T­íng Qu©n LÖnh Bµi , LÖnh Kú(§Æt trang søc cÇn n©ng cÊp vµo « trang bÞ  ®Çu tiªn)/#Upgrade_NLTQ(4)")
	tinsert(tSay, "§Ó ta suy nghÜ l¹i/DoNothing")
	Say("C¸c h¹ h·y chän lo¹i ngo¹i trang muèn n©ng cÊp:", getn(tSay), tSay)
end

function Upgrade_NLTQ(nCloth)
	if gf_JudgeRoomWeight(2,500,"<color=green>§Ö tö thî rÌn L­u: <color>") == 0 then
		return 0;
	end
	
	local nG, nD, nP  = GetPlayerEquipInfo(nCloth)
	local cloth_index = GetPlayerEquipIndex(nCloth)
	
	if  cloth_index <= 0 then
		Talk(1,"","H·y mang trang bÞ trªn ng­êi tr­íc råi ®Õn t×m ta!")
		return
	end

	local nCheck = Check_GDP(nG, nD, nP)
	if nCheck <= 0 then
		Talk(1,"","Ngo¹i trang n©ng cÊp kh«ng phï hîp!")
		return
	end
	
	local cloth_level = GetEquipAttr(cloth_index, 2)
	local	nDing = GetItemSpecialAttr(cloth_index,"DING7")
	if  nD ~= 102 and (nDing <= 0 or cloth_level < 7) then
		Talk(1,"","Trang bÞ c¶i t¹o ph¶i cÊp 7 trë lªn vµ cã §Þnh Hån!")
		return
	end
	
	local cloth_name = GetItemName(cloth_index)
	if AbradeItem(cloth_index, 0) == 0 then
		Talk(1,"", cloth_name.." ®· hÕt ®é bÒn, kh«ng thÓ n©ng cÊp!")
		return
	end
	
	local nResource1 = 30
	if nD == 102 then
		nResource1 = 45
	end	
	if GetItemCount(2,1,30302) < nResource1 then
		Talk(1,"","Trong hµnh trang cña ®¹i hiÖp kh«ng ®ñ "..nResource1.." Ngò Hµnh Kú Th¹ch")
		return
	end
	
	local nResource2 = 5
	if nD == 102 then
		nResource2 = 10
	end
	if GetItemCount(2,1,30321) < nResource2 then
		Talk(1,"","Trong hµnh trang cña ®¹i hiÖp kh«ng ®ñ "..nResource2.." Thiªn Ngo¹i L­u Tinh")
		return
	end
	
	if GetCash() < 5000000 then
		Talk(1,"","§¹i hiÖp kh«ng ®ñ 500 vµng")
		return
	end
	
	UnEquipAtPosition(nCloth)
	if (DelItemByIndex(cloth_index, -1) == 1) and (DelItem(2, 1, 30302, nResource1) == 1) and (DelItem(2, 1, 30321, nResource2) == 1) and Pay(5000000) == 1 then
		local nRes, nIndex = 0, 0
		if nD ~= 102 then
			nRes, nIndex = gf_AddItemEx2({nG, nD, nP, 1,1,-1,-1,-1,-1,-1,-1,-1,7}, tb_upgrade_nltq[nCheck][2], "Cai tao trang bi Ngu Long Tuong Quan", "n©ng cÊp ®­îc")
			if  nRes > 0 then
				SetItemSpecialAttr(nIndex,"DING7",nDing)
			end
		else
			nRes, nIndex = gf_AddItemEx2({nG, nD, nP, 1,1,-1,-1,-1,-1,-1,-1}, tb_upgrade_nltq[nCheck][2], "Cai tao trang bi Ngu Long Tuong Quan", "n©ng cÊp ®­îc")
		end
		Talk(1,"","§¹i hiÖp ®· c¶i t¹o trang bÞ "..tb_upgrade_nltq[nCheck][2].." thµnh c«ng!")
	else
		Talk(1,"","C¶i t¹o trang bÞ thÊt b¹i !")
	end
end

function Check_GDP(nG, nD, nP)
	for i = 1, getn(tb_upgrade_nltq) do 
		if (tb_upgrade_nltq[i][1][1] == nG) and (tb_upgrade_nltq[i][1][2] == nD) and (tb_upgrade_nltq[i][1][3] == nP) then
			return i
		end
	end
	return 0
end

function DoNothing()

end